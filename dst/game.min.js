function t(t){this.hero=t;this.enemies=[];for(let t=0;t<300;t++){let i=t/300*2*Math.PI,h=new e(13,16,S.ENEMY,t,300);h.e.x=this.hero.x+600*Math.cos(i),h.e.y=this.hero.y+600*Math.sin(i),this.enemies.push(h)}this.update=function(t,e){this.enemies.forEach(e=>{e.update(t,this.enemies),e.e.update(t)}),this.enemies=this.enemies.filter(function(t){return t.active})}}function e(t,e,i,h,s){this.active=!0,this.e=new M(12,16,0,0,0,i),this.speed=.8,this.angleOffset=2*Math.PI*(h/s),this.update=function(t,e){let i=this.steerFromNearbyMobs(e,60),h=ft.hero.e.x+50*Math.cos(this.angleOffset),s=ft.hero.e.y+50*Math.sin(this.angleOffset);this.e.x+=(h-this.e.x>0?this.speed:-this.speed)+i.x,this.e.y+=(s-this.e.y>0?this.speed:-this.speed)+i.y,this.e.isCollidingWith(ft.hero.e)&&(console.log("Enemy is touching the hero!"),this.active=!1)},this.steerFromNearbyMobs=function(t,e){let i=0,h=0,s=0;for(let n=0;n<t.length;n++){let a=t[n],o=Math.sqrt(Math.pow(this.e.x-a.e.x,2)+Math.pow(this.e.y-a.e.y,2));a!==this&&o<e&&(i+=this.e.x-a.e.x,h+=this.e.y-a.e.y,s++)}s>0&&(i/=s,h/=s);let n=Math.sqrt(i*i+h*h);return n>0&&(i/=n,h/=n),{x:i,y:h}}}function i(t=0,e=0){this.x=t,this.y=e}var h=37,n=39,a=38,o=40,l=16,y=87,d=65,x=83,u=68,f=77,g=0,w=2,m=32,p=69,H=49,E=50,k=51,I=52,A=82,v=84;function M(t,e,i,h,n,a){this.type=a,this.width=t,this.height=e,this.mhWidth=t/-2,this.mhHeight=e/-2,this.mhWScld=t/-2,this.mhHScld=e/-2,this.hWidth=t/2,this.hHeight=e/2,this.cenX=i-this.mhWScld,this.cenY=h-this.mhHScld,this.angle=n,this.x=i,this.y=h,this.image=ut,this.alpha=1,this.isSolid=!1,this.sx=0,this.sy=0,this.move=function(){Ct()&&(this.x-=5),Ot()&&(this.x+=5),Yt()&&(this.y-=5),Nt()&&(this.y+=5)},this.update=function(i){this.x=Math.floor(this.x),this.Y=Math.floor(this.Y),ctx.save(),ctx.translate(this.x,this.y),ctx.globalAlpha=this.alpha,img=this.image,s=this.scale,mhw=this.mhWidth,mhh=this.mhHeight,hw=this.hWidth,hh=this.hHeight,t=this.width,e=this.height,ctx.translate(ft.cam.x,ft.cam.y),ctx.scale(kt,kt),ctx.drawImage(img,this.sx,this.sy,t,e,hw,hh,t,e),ctx.restore(),this.cenX=this.x-this.mhWScld,this.cenY=this.y-this.mhHScld},this.isCollidingWith=function(t){return!(this.x+this.width<t.x-t.width||this.x-this.width>t.x+t.width||this.y+this.height<t.y-t.height||this.y-this.height>t.y+t.height)},this.setType=function(){switch(this.alpha=1,this.sy=0,this.sx=0,this.type){case S.HERO:break;case S.ENEMY:case S.GRASS:this.sx=16;break;case S.SHIELD:this.sx=33;break;case S.HAIR1:this.sx=63,this.width=13,this.height=13;break;case S.HAIR2:this.sx=77,this.width=15,this.height=12;break;case S.HAIR3:this.sx=94,this.width=13,this.height=11;break;case S.HAIR4:this.sx=50,this.sy=12,this.width=11,this.height=8;break;case S.HEAD1:this.sx=2,this.sy=1;break;case S.HEAD2:this.sx=48,this.sy=1;break;case S.HEAD3:this.sx=11,this.sy=17;break;case S.HAND:this.sx=30,this.sy=9;break;case S.ARROW:this.sx=36,this.sy=3}this.hWidth=this.width/2,this.hHeight=this.height/2},this.setType()}function b(t,e,i,h,s,n){this.e=new M(16,16,0,0,0,S.HERO),this.hair=new M(13,13,0,0,0,S.HAIR1),this.head=new M(11,9,0,0,0,S.HEAD1),this.rHand=new M(4,4,0,0,0,S.HAND),this.lHand=new M(4,4,0,0,0,S.HAND),this.change=!1,this.update=function(t){switch(this.e.move(t),this.e.update(t),this.head.x=this.e.x+18,this.head.y=this.e.y+18,this.head.update(t),this.hair.type){case S.HAIR1:this.hair.x=this.e.x+8,this.hair.y=this.e.y-6;break;case S.HAIR2:this.hair.x=this.e.x-6,this.hair.y=this.e.y-8;break;case S.HAIR3:this.hair.x=this.e.x+10,this.hair.y=this.e.y+2;break;case S.HAIR4:this.hair.x=this.e.x+18,this.hair.y=this.e.y+20}this.change&&(this.hairChange=!1,this.head.setType(),this.hair.setType()),this.hair.update(t),this.rHand.x=this.e.x+65,this.rHand.y=this.e.y+65,this.lHand.x=this.e.x+25,this.lHand.y=this.e.y+65,this.rHand.update(t),this.lHand.update(t)}}const S={AIR:0,GRASS:1,HERO:2,ENEMY:3,SHIELD:4,HAIR1:5,HAIR2:6,HAIR3:7,HAIR4:8,HAND:9,HEAD1:10,HEAD2:11,HEAD3:12,ARROW:13};function R(t,e,i){angle=2*Math.PI*(e/i),e>=i&&(angle=2*Math.PI),t.beginPath(),t.fillStyle="#cccccc",t.moveTo(400,35),t.arc(400,35,30,0,2*Math.PI),t.closePath(),t.fill(),t.beginPath(),t.fillStyle="white",t.moveTo(400,35),t.arc(400,35,30,-Math.PI/2,angle-Math.PI/2,!1),t.closePath(),t.fill(),t.beginPath(),t.moveTo(400,35),t.lineTo(400+30*Math.cos(angle-Math.PI/2),35+30*Math.sin(angle-Math.PI/2)),t.strokeStyle="#000000",t.lineWidth=3,t.stroke()}function D(t,e,i,h,s){t.save(),t.translate(0,s);t.fillStyle="black",t.fillRect(10,10,200,20);const n=200*(e/i);t.fillStyle="grey",t.fillRect(12,12,196,16),t.fillStyle=h,t.fillRect(12,12,n-4,16),t.font="14px Arial",t.fillStyle="white",t.textAlign="center",t.textBaseline="middle";t.fillText(`${e} / ${i}`,110,20),t.restore()}function W(t,e,i,h){this.x=t,this.y=e,this.w=i,this.h=h}function T(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function L(t){return new W(t.x,t.y,t.w,t.h)}function P(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y}function C(t,e){this.x=t,this.y=e,this.set=function(t,e){this.x=t,this.y=e}}function O(t,e,i,h,s,n,a,o,r){t.save(),t.globalAlpha=r,t.translate(e,i),t.fillStyle=o,t.fillRect(h,s,n,a),t.restore()}function Y(t,e,i){return(1-i)*t+i*e}function N(t,e){return cenX=Math.floor(t/2),cenY=Math.floor(e/2),{x:16*(cenX-cenY)/2,y:16*(cenX+cenY)/2}}function F(t){const e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0);return Math.round(e*t)}function X(t,e,i,h,s,n,a){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=e,t.fillStyle=i,t.fillRect(h,s,n,a),t.restore()}function q(t,e,i,h,s,n,a){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=e,t.font=i,t.fillStyle=h,t.fillText(s,n,a),t.restore()}function G(t,e,i,h){let s=t/32,n=(e+2*i+h)/32*2,a=n-s,o=s+n;return r=Math.floor(a),c=Math.floor(o),$(r,c)}function $(t,e){return ft.level.tiles[e+ft.levels[ft.hero.e.curLevel].cols*t]}function z(t,e,i){let h=t.e.x>e.x?1:-1,s=t.e.y>e.y?1:-1;t.e.x+=h*i,t.e.y+=s*i}const B={0:[[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1]],1:[[0,0,1,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],2:[[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1]],3:[[1,1,1,1,1],[0,0,0,0,1],[0,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]],4:[[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[0,0,0,0,1],[0,0,0,0,1]],5:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]],6:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1]],7:[[1,1,1,1,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[0,1,0,0,0]],8:[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1]],9:[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]]};function J(t,e,i,h){for(let s=0;s<B[i].length;s++)for(let n=0;n<B[i][s].length;n++)1===B[i][s][n]&&(ctx.fillStyle="white",ctx.fillRect(t+n*h,e+s*h,h,h))}function j(t){Wt.context.fillStyle="yellow",Wt.context.font="16px Arial",Wt.context.fillText("FPS: "+t.toFixed(2),Mt-100,20)}function K(t){Wt.context.fillStyle="white",Wt.context.font="16px Arial",Wt.context.fillText("Mobs: "+t,Mt-100,50)}function Q(t){this.hero=t,this.rotatingEntity=new M(8,8,0,0,0,S.SHIELD),this.spinningEntity=new M(4,4,0,0,0,S.SHIELD),this.chasingEntity=new M(8,8,0,0,0,S.SHIELD),this.helicalEntity=new M(8,8,0,0,0,S.SHIELD),this.figureEightEntity=new M(4,4,0,0,0,S.SHIELD),this.rotate=!1,this.spin=!1,this.chase=!1,this.loop=!1,this.update=function(t,e){if(this.rotate){let i=60,h=2,s=2*e*Math.PI/h;this.rotatingEntity.x=this.hero.x+32+i*Math.cos(s),this.rotatingEntity.y=this.hero.y+32+i*Math.sin(s),this.rotatingEntity.update(t)}if(this.spin){let i=60,h=2*e*Math.PI/.6;this.spinningEntity.x=this.rotatingEntity.x+16+i*Math.cos(h),this.spinningEntity.y=this.rotatingEntity.y+16+i*Math.sin(h),this.spinningEntity.update(t)}if(this.rotate){let e=.1,i=this.hero.x-this.chasingEntity.x,h=this.hero.y-this.chasingEntity.y;Math.sqrt(i*i+h*h)>1&&(this.chasingEntity.x+=e*i,this.chasingEntity.y+=e*h),this.chasingEntity.update(t)}if(this.loop){radius=80;let i=2,h=this.hero.x+32+radius*Math.sin(e*i),s=this.hero.y+50+radius*Math.sin(2*e*i);this.figureEightEntity.x=h,this.figureEightEntity.y=s,this.figureEightEntity.update(t)}}}function U(){this.arrow=new M(11,12,100,60,0,S.ARROW);let t=0;this.update=function(e){let i=F(.05);Wt.clear(),ctx.save(),X(ctx,.8,"black",0,0,Z,_);let h=`${i}px Arial`;if(q(ctx,1,h,"WHITE","GameDevJS 2024 ",30,.1*_),q(ctx,1,h,"WHITE",Et>0?"Generating World ..":"",30,_-120),h=`${i-15}px Arial`,Yt()&&t<=0&&et>0?(t=.3,et--):Nt()&&t<=0&&et<3&&(t=.3,et++),0==et)if(this.arrow.y=90,q(ctx,1,h,"WHITE","Select Hair (Left / Right)",30,.2*_),(Ct()||Ot())&&t<=0){t=.3;const e=[S.HAIR1,S.HAIR2,S.HAIR3,S.HAIR4];ft.hero.hair.type=e[(e.indexOf(ft.hero.hair.type)+1)%e.length],ft.hero.change=!0}else Ft()&&t<=0&&(et=1,t=.3);else if(1==et)if(this.arrow.y=120,q(ctx,1,h,"WHITE","Select Head (Left / Right)",30,.2*_),(Ct()||Ot())&&t<=0){t=.3;const e=[S.HEAD1,S.HEAD2,S.HEAD3];ft.hero.head.type=e[(e.indexOf(ft.hero.head.type)+1)%e.length],ft.hero.change=!0,ft.hero.head.type==S.HEAD3||ft.hero.head.type==S.HEAD2?(ft.hero.rHand.sx=16,ft.hero.rHand.sy=28,ft.hero.lHand.sx=16,ft.hero.lHand.sy=28):(ft.hero.rHand.sx=30,ft.hero.rHand.sy=9,ft.hero.lHand.sx=30,ft.hero.lHand.sy=9)}else Ft()&&t<=0&&(et=2,t=.3);else 2==et?(this.arrow.y=150,q(ctx,1,h,"WHITE","Select Clothes (Left / Right)",30,.2*_)):3==et&&(this.arrow.y=190,q(ctx,1,h,"WHITE","[ Start ]",Z/2-90,_-60));t-=e,ft.hero.e.x=70,ft.hero.e.y=20,ctx.save(),ctx.scale(3,3),ft.hero.update(e),ctx.restore(),ctx.save(),ctx.scale(1.5,1.5),this.arrow.update(e),ctx.restore()}}function V(){this.cam=new i,this.tips=!0,this.time=0,this.reset=!1,this.hero=new b(16,16,0,0,0,S.HERO),this.attacks=new Q(this.hero),this.spawner=new t(this.hero.e),this.intro=new U;let e=3,h=20,s=0;this.update=function(t,i=!1){i?(this.cam.x=Y(350-this.hero.e.x,this.cam.x,.1),this.cam.y=Y(200-this.hero.e.y,this.cam.y,.1),nt+=t,Wt.clear(),this.time+=t,this.hero.update(t),e<=0?(this.spawner.update(t,this.time),this.attacks.update(t,this.time),R(ctx,nt,20),nt>=20&&(nt=0,e=3,this.spawner.enemies=[])):(e-=t,Math.ceil(e)!=s&&(h=20),h+=.3,s=Math.ceil(e),J(330,80,Math.ceil(e),h)),D(ctx,100,100,"red",0),D(ctx,50,100,"lime",30),K(this.spawner.enemies.length),j(It)):this.intro.update(t)}}let Z=window.innerWidth,_=window.innerHeight,tt=!1,et=0,it=0,ht=Date.now(),st=Date.now(),nt=0,at=new C(0,0),ot=new C(0,0),rt=new W(0,0,0,0),ct=!1,lt=!1,yt=!1,dt=!1,xt=0,ut=new Image;ut.src="atlas.png";let ft=new V,gt=!1,wt=!0,mt=!1,pt=!1,Ht=!1,Et=.1,kt=4,It=60,At=0,vt=0;var Mt=800,bt=600,St=window.innerWidth,Rt=window.innerHeight,Dt=Math.max(St/Mt,Rt/bt);function startGame(){Wt.start(),jt(this.ctx)}let Wt={canvas:document.createElement("canvas"),start:function(){this.canvas.width=Mt*Dt,this.canvas.height=bt*Dt,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),this.context.setTransform(Dt,0,0,Dt,0,0),ctx=this.context,ctx.mozImageSmoothingEnabled=!1,ctx.webkitImageSmoothingEnabled=!1,ctx.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameId=requestAnimationFrame(Lt),window.addEventListener("keydown",function(t){Et<=0&&3==et&&(gt=!0),t.preventDefault(),Wt.keys=Wt.keys||[],Wt.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){Wt.keys[t.keyCode]="keydown"==t.type,t.keyCode==A&&(yt=!0),t.keyCode==f&&(mt=!mt),t.keyCode==v&&(ft.tips=!ft.tips)}),window.addEventListener("mouseup",function(t){t.preventDefault(),Jt(),ct=!0,0===t.button?pt=!1:2===t.button&&(Ht=!1)}),window.addEventListener("mousedown",function(t){t.preventDefault(),0===t.button?pt=!0:2===t.button&&(Ht=!0)}),window.addEventListener("resize",jt),window.addEventListener("mousemove",function(t){t.preventDefault();var e=Wt.canvas.getBoundingClientRect();at.set((t.clientX-e.left)/(e.right-e.left)*Z,(t.clientY-e.top)/(e.bottom-e.top)*_)}),this.canvas.oncontextmenu=function(t){t.preventDefault()}},stop:function(){Wt.frameId&&(cancelAnimationFrame(Wt.frameId),Wt.frameId=null)},clear:function(){this.context.clearRect(0,0,4*this.canvas.width,4*this.canvas.height)}},Tt=null;function Lt(t){Tt||(Tt=t);let e=(t-Tt)/1e3;Tt=t,At++,(vt+=e)>=1&&(It=At/vt,At=0,vt=0),Pt(e),j(It),Wt.frameId=requestAnimationFrame(Lt)}function Pt(t){lt&&(nt=0,lt=!1,dt=!1,xt=0,gt=!1,tt=!1,Et=3),gt&&(tt=!0),Et>0&&(Et-=t),ft.update(t,tt),ct=!1}function Ct(){return Wt.keys&&(Wt.keys[h]||Wt.keys[d])}function Ot(){return Wt.keys&&(Wt.keys[n]||Wt.keys[u])}function Yt(){return Wt.keys&&(Wt.keys[a]||Wt.keys[y])}function Nt(){return Wt.keys&&(Wt.keys[o]||Wt.keys[x])}function Ft(){return Wt.keys&&Wt.keys[m]||pt}function Xt(){return Wt.keys&&Wt.keys[l]||Ht}function qt(){return Wt.keys&&Wt.keys[H]}function Gt(){return Wt.keys&&Wt.keys[E]}function $t(){return Wt.keys&&Wt.keys[k]}function zt(){return Wt.keys&&Wt.keys[I]}function Bt(){return Wt.keys&&Wt.keys[v]}function Jt(){ot.set(at.x,at.y),rt.x=at.x-5,rt.y=at.y+5,rt.h=10,rt.w=10,console.log(ot)}function jt(){St=window.innerWidth,Rt=window.innerHeight,Dt=Math.max(St/Mt,Rt/bt),ctx.canvas.width=Mt*Dt,ctx.canvas.height=bt*Dt,this.context=ctx.canvas.getContext("2d"),this.context.setTransform(Dt,0,0,Dt,0,0),this.ctx.mozImageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1}