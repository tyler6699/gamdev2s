function t(){this.decors=[];var t=60;for(let e=0;e<t;e++){let t=4e3*Math.random()-2e3,e=4e3*Math.random()-2e3;this.decors.push(new b(9,6,t,e,0,R.SMALLROCK))}numRocks=50;for(let e=0;e<t;e++){let t=4e3*Math.random()-2e3,e=4e3*Math.random()-2e3;this.decors.push(new b(14,10,t,e,0,R.BIGROCK))}t=30;for(let e=0;e<t;e++){let t=4e3*Math.random()-2e3,e=4e3*Math.random()-2e3;this.decors.push(new b(14,14,t,e,0,R.STUMP))}t=20;for(let e=0;e<t;e++){let t=4e3*Math.random()-2e3,e=4e3*Math.random()-2e3;this.decors.push(new b(10,9,t,e,0,R.BIGMUSH))}t=40;for(let e=0;e<t;e++){let t=4e3*Math.random()-2e3,e=4e3*Math.random()-2e3;this.decors.push(new b(7,7,t,e,0,R.SMALLMUSH))}this.update=function(t,e){this.decors.forEach(e=>{e.update(t)})}}function e(t){this.hero=t;this.enemies=[];for(let t=0;t<300;t++){let e=t/300*2*Math.PI,h=new i(13,16,R.ENEMY,t,300);h.e.x=this.hero.x+600*Math.cos(e),h.e.y=this.hero.y+600*Math.sin(e),this.enemies.push(h)}this.update=function(t,e){this.enemies.forEach(e=>{e.update(t,this.enemies),e.e.update(t)}),this.enemies=this.enemies.filter(function(t){return t.active})}}function i(t,e,i,h,s){this.active=!0,this.e=new b(12,16,0,0,0,i),this.speed=.8,this.angleOffset=2*Math.PI*(h/s),this.update=function(t,e){let i=this.steerFromNearbyMobs(e,60),h=mt.hero.e.x+50*Math.cos(this.angleOffset),s=mt.hero.e.y+50*Math.sin(this.angleOffset);this.e.x+=(h-this.e.x>0?this.speed:-this.speed)+i.x,this.e.y+=(s-this.e.y>0?this.speed:-this.speed)+i.y,this.e.isCollidingWith(mt.hero.e)&&(this.active=!1)},this.steerFromNearbyMobs=function(t,e){let i=0,h=0,s=0;for(let n=0;n<t.length;n++){let a=t[n],o=Math.sqrt(Math.pow(this.e.x-a.e.x,2)+Math.pow(this.e.y-a.e.y,2));a!==this&&o<e&&(i+=this.e.x-a.e.x,h+=this.e.y-a.e.y,s++)}s>0&&(i/=s,h/=s);let n=Math.sqrt(i*i+h*h);return n>0&&(i/=n,h/=n),{x:i,y:h}}}function h(t=0,e=0){this.x=t,this.y=e}var n=37,a=39,o=38,l=40,x=16,f=87,d=65,y=83,u=68,g=77,w=0,m=2,p=32,H=69,M=49,E=50,k=51,S=52,v=82,A=84;function b(t,e,i,h,n,a){this.type=a,this.width=t,this.height=e,this.mhWidth=t/-2,this.mhHeight=e/-2,this.mhWScld=t/-2,this.mhHScld=e/-2,this.hWidth=t/2,this.hHeight=e/2,this.cenX=i-this.mhWScld,this.cenY=h-this.mhHScld,this.angle=n,this.x=i,this.y=h,this.image=wt,this.alpha=1,this.isSolid=!1,this.sx=0,this.sy=0,this.move=function(){Gt()&&(this.x-=5),Nt()&&(this.x+=5),Kt()&&(this.y-=5),Ut()&&(this.y+=5),this.x<-2e3&&(this.x=-2e3),this.x>2e3&&(this.x=2e3),this.y<-2e3&&(this.y=-2e3),this.y>2e3&&(this.y=2e3)},this.update=function(i){this.x=Math.floor(this.x),this.Y=Math.floor(this.Y),ctx.save(),ctx.translate(this.x,this.y),ctx.globalAlpha=this.alpha,img=this.image,s=this.scale,mhw=this.mhWidth,mhh=this.mhHeight,hw=this.hWidth,hh=this.hHeight,t=this.width,e=this.height,ctx.translate(mt.cam.x,mt.cam.y),ctx.scale(vt,vt),ctx.drawImage(img,this.sx,this.sy,t,e,hw,hh,t,e),ctx.restore(),this.cenX=this.x-this.mhWScld,this.cenY=this.y-this.mhHScld},this.isCollidingWith=function(t){return!(this.x+this.width<t.x-t.width||this.x-this.width>t.x+t.width||this.y+this.height<t.y-t.height||this.y-this.height>t.y+t.height)},this.setType=function(){switch(this.alpha=1,this.sy=0,this.sx=0,this.type){case R.HERO:break;case R.ENEMY:case R.GRASS:this.sx=16;break;case R.SHIELD:this.sx=33;break;case R.HAIR1:this.sx=63,this.width=13,this.height=13;break;case R.HAIR2:this.sx=77,this.width=15,this.height=12;break;case R.HAIR3:this.sx=94,this.width=13,this.height=11;break;case R.HAIR4:this.sx=50,this.sy=12,this.width=11,this.height=8;break;case R.HEAD1:this.sx=2,this.sy=1;break;case R.HEAD2:this.sx=48,this.sy=1;break;case R.HEAD3:this.sx=11,this.sy=17;break;case R.HAND:this.sx=30,this.sy=9;break;case R.ARROW:this.sx=36,this.sy=3;break;case R.SMALLROCK:this.sx=24,this.sy=17;break;case R.BIGROCK:this.sx=35,this.sy=16;break;case R.STUMP:this.sx=23,this.sy=25;break;case R.SMALLMUSH:this.sy=32;break;case R.BIGMUSH:this.sy=20}this.hWidth=this.width/2,this.hHeight=this.height/2},this.setType()}function I(t,e,i,h,s,n){this.e=new b(16,16,0,0,0,R.HERO),this.hair=new b(13,13,0,0,0,R.HAIR1),this.head=new b(11,9,0,0,0,R.HEAD1),this.rHand=new b(4,4,0,0,0,R.HAND),this.lHand=new b(4,4,0,0,0,R.HAND),this.change=!1,this.update=function(t){switch(this.e.move(t),this.e.update(t),this.head.x=this.e.x+18,this.head.y=this.e.y+18,this.head.update(t),this.hair.type){case R.HAIR1:this.hair.x=this.e.x+8,this.hair.y=this.e.y-6;break;case R.HAIR2:this.hair.x=this.e.x-6,this.hair.y=this.e.y-8;break;case R.HAIR3:this.hair.x=this.e.x+10,this.hair.y=this.e.y+2;break;case R.HAIR4:this.hair.x=this.e.x+18,this.hair.y=this.e.y+20}this.change&&(this.hairChange=!1,this.head.setType(),this.hair.setType()),this.hair.update(t),this.rHand.x=this.e.x+65,this.rHand.y=this.e.y+65,this.lHand.x=this.e.x+25,this.lHand.y=this.e.y+65,this.rHand.update(t),this.lHand.update(t)}}const R={AIR:0,GRASS:1,HERO:2,ENEMY:3,SHIELD:4,HAIR1:5,HAIR2:6,HAIR3:7,HAIR4:8,HAND:9,HEAD1:10,HEAD2:11,HEAD3:12,ARROW:13,SMALLROCK:14,BIGROCK:15,STUMP:16,BIGMUSH:17,SMALLMUSH:18};function L(t,e,i){angle=2*Math.PI*(e/i),e>=i&&(angle=2*Math.PI),t.beginPath(),t.fillStyle=1==Ct?"#a6f1c8":"#ffb3a6",t.moveTo(400,35),t.arc(400,35,30,0,2*Math.PI),t.closePath(),t.fill(),t.beginPath(),t.fillStyle="white",t.moveTo(400,35),t.arc(400,35,30,-Math.PI/2,angle-Math.PI/2,!1),t.closePath(),t.fill(),t.beginPath(),t.moveTo(400,35),t.lineTo(400+30*Math.cos(angle-Math.PI/2),35+30*Math.sin(angle-Math.PI/2)),t.strokeStyle=1==Ct?"#589572":"#f8847c",t.lineWidth=3,t.stroke()}function D(t,e,i,h,s,n,a){t.save(),t.translate(0,a);t.fillStyle=s,t.fillRect(10,10,200,20);const o=200*(e/i);t.fillStyle=n,t.fillRect(12,12,196,16),t.fillStyle=h,t.fillRect(12,12,o-4,16),t.font="14px Arial",t.fillStyle="black",t.textAlign="center",t.textBaseline="middle";t.fillText(`${e} / ${i}`,110,20),t.restore()}function T(t,e,i,h){this.x=t,this.y=e,this.w=i,this.h=h}function W(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function C(t){return new T(t.x,t.y,t.w,t.h)}function P(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y}function O(t,e){this.x=t,this.y=e,this.set=function(t,e){this.x=t,this.y=e}}function B(t,e,i,h,s,n,a,o,c){t.save(),t.globalAlpha=c,t.translate(e,i),t.fillStyle=o,t.fillRect(h,s,n,a),t.restore()}function Y(t,e,i){return(1-i)*t+i*e}function G(t,e){return cenX=Math.floor(t/2),cenY=Math.floor(e/2),{x:16*(cenX-cenY)/2,y:16*(cenX+cenY)/2}}function N(t){const e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0);return Math.round(e*t)}function K(t,e,i,h,s,n,a){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=e,t.fillStyle=i,t.fillRect(h,s,n,a),t.restore()}function U(t,e,i,h,s,n,a){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=e,t.font=i,t.fillStyle=h,t.fillText(s,n,a),t.restore()}function F(t,e,i,h,s,n,a,o){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=e,t.font=i,t.fillStyle=h,t.strokeStyle=h,t.lineWidth=o,t.strokeText(s,n,a),t.restore()}function X(t,e,i,h){let s=t/32,n=(e+2*i+h)/32*2,a=n-s,o=s+n;return r=Math.floor(a),c=Math.floor(o),q(r,c)}function q(t,e){return mt.level.tiles[e+mt.levels[mt.hero.e.curLevel].cols*t]}function $(t,e,i){let h=t.e.x>e.x?1:-1,s=t.e.y>e.y?1:-1;t.e.x+=h*i,t.e.y+=s*i}const z={0:[[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1]],1:[[0,0,1,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],2:[[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1]],3:[[1,1,1,1,1],[0,0,0,0,1],[0,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]],4:[[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[0,0,0,0,1],[0,0,0,0,1]],5:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]],6:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1]],7:[[1,1,1,1,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[0,1,0,0,0]],8:[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1]],9:[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]]};function J(t,e,i,h){for(let s=0;s<z[i].length;s++)for(let n=0;n<z[i][s].length;n++)1===z[i][s][n]&&(ctx.fillStyle="white",ctx.fillRect(t+n*h,e+s*h,h,h))}function j(t){Pt.context.fillStyle="yellow",Pt.context.font="16px Arial",Pt.context.fillText("FPS: "+t.toFixed(2),Rt-100,20)}function Q(t){Pt.context.fillStyle="white",Pt.context.font="16px Arial",Pt.context.fillText("Mobs: "+t,Rt-100,50)}function V(t,e,i,h,s,n){ctx.save(),ctx.scale(3,3),ctx.shadowColor=1==n?"#3CB371":"#f67c84",ctx.shadowBlur=10,ctx.shadowOffsetX=5,ctx.shadowOffsetY=5,ctx.fillStyle="white",ctx.fill(),ctx.strokeStyle=1==n?"#3CB371":"#ffb3a6",ctx.lineWidth=4,ctx.stroke(),ctx.beginPath(),ctx.roundRect(50,45,150,90,40),ctx.stroke(),ctx.fill(),ctx.restore()}function Z(t){this.hero=t,this.rotatingEntity=new b(8,8,0,0,0,R.SHIELD),this.spinningEntity=new b(4,4,0,0,0,R.SHIELD),this.chasingEntity=new b(8,8,0,0,0,R.SHIELD),this.helicalEntity=new b(8,8,0,0,0,R.SHIELD),this.figureEightEntity=new b(4,4,0,0,0,R.SHIELD),this.rotate=!1,this.spin=!1,this.chase=!1,this.loop=!1,this.update=function(t,e){if(this.rotate){let i=60,h=2,s=2*e*Math.PI/h;this.rotatingEntity.x=this.hero.x+32+i*Math.cos(s),this.rotatingEntity.y=this.hero.y+32+i*Math.sin(s),this.rotatingEntity.update(t)}if(this.spin){let i=60,h=2*e*Math.PI/.6;this.spinningEntity.x=this.rotatingEntity.x+16+i*Math.cos(h),this.spinningEntity.y=this.rotatingEntity.y+16+i*Math.sin(h),this.spinningEntity.update(t)}if(this.rotate){let e=.1,i=this.hero.x-this.chasingEntity.x,h=this.hero.y-this.chasingEntity.y;Math.sqrt(i*i+h*h)>1&&(this.chasingEntity.x+=e*i,this.chasingEntity.y+=e*h),this.chasingEntity.update(t)}if(this.loop){radius=80;let i=2,h=this.hero.x+32+radius*Math.sin(e*i),s=this.hero.y+50+radius*Math.sin(2*e*i);this.figureEightEntity.x=h,this.figureEightEntity.y=s,this.figureEightEntity.update(t)}}}function _(){this.arrow=new b(11,12,100,60,0,R.ARROW);let t=0,e=0;this.update=function(i){let h=N(.05);Pt.clear(),ctx.save(),K(ctx,.8,"black",0,0,et,it);var s=["#a8f2cb","#88e4b0"];s=1==Ct?["#a8f2cb","#88e4b0"]:["#ffb3a6","#ff9e9a"];const n=Math.ceil(Math.sqrt(ctx.canvas.width**2+ctx.canvas.height**2)/50);for(let t=-n;t<n+10;t++)ctx.fillStyle=s[t%2],ctx.beginPath(),ctx.moveTo(50*t+e,0),ctx.lineTo(50*(t+1)+e,0),ctx.lineTo(50*(t+1)+e-ctx.canvas.height,ctx.canvas.height),ctx.lineTo(50*t+e-ctx.canvas.height,ctx.canvas.height),ctx.closePath(),ctx.fill();(e-=.5)<=-100&&(e=0);let a=`${h}px Arial`;if(F(ctx,1,a,"Black","GameDevJS 2024",30,.1*it,12),U(ctx,1,a,"WHITE","GameDevJS 2024 ",30,.1*it),a=`${h-15}px Arial`,t<=0&&(Kt()?(t=.3,st--):Ut()&&(t=.3,st++),jt()&&(Ct=(Ct+1)%2,t=.3)),st=(st+3)%3,V(0,0,300,300,15,Ct),0==st){if(this.arrow.y=100,F(ctx,1,a,"BLACK","Select Hair (Left / Right)",30,.2*it,6),U(ctx,1,a,"WHITE","Select Hair (Left / Right)",30,.2*it),(Gt()||Nt())&&t<=0){t=.3;const e=[R.HAIR1,R.HAIR2,R.HAIR3,R.HAIR4];mt.hero.hair.type=e[(e.indexOf(mt.hero.hair.type)+1)%e.length],mt.hero.change=!0}}else if(1==st){if(this.arrow.y=140,F(ctx,1,a,"BLACK","Select Head (Left / Right)",30,.2*it,6),U(ctx,1,a,"WHITE","Select Head (Left / Right)",30,.2*it),(Gt()||Nt())&&t<=0){t=.3;const e=[R.HEAD1,R.HEAD2,R.HEAD3];mt.hero.head.type=e[(e.indexOf(mt.hero.head.type)+1)%e.length],mt.hero.change=!0,mt.hero.head.type==R.HEAD3||mt.hero.head.type==R.HEAD2?(mt.hero.rHand.sx=16,mt.hero.rHand.sy=28,mt.hero.lHand.sx=16,mt.hero.lHand.sy=28):(mt.hero.rHand.sx=30,mt.hero.rHand.sy=9,mt.hero.lHand.sx=30,mt.hero.lHand.sy=9)}}else 2==st&&(this.arrow.y=170,F(ctx,1,a,"BLACK","Select Clothes (Left / Right)",30,.2*it,6),U(ctx,1,a,"WHITE","Select Clothes (Left / Right)",30,.2*it));t-=i,mt.hero.e.x=65,mt.hero.e.y=30,ctx.save(),ctx.scale(3,3),mt.hero.update(i),ctx.restore(),ctx.save(),ctx.scale(1.5,1.5),this.arrow.update(i),ctx.restore(),F(ctx,1,a,"Black","Space to Start",.5*it,.88*it,12),U(ctx,1,a,"WHITE","Space to Start",.5*it,.88*it),Ft()&&(ht=!0)}}function tt(){this.cam=new h,this.tips=!0,this.time=0,this.reset=!1,this.hero=new I(16,16,0,0,0,R.HERO),this.attacks=new Z(this.hero),this.spawner=new e(this.hero.e),this.decor=new t,this.intro=new _;let i=3,s=20,n=0;this.update=function(t,e=!1){e?(this.cam.x=Y(350-this.hero.e.x,this.cam.x,.1),this.cam.y=Y(200-this.hero.e.y,this.cam.y,.1),ct+=t,Pt.clear(),ctx.fillStyle=0==Ct?"#a6f1c8":"#ffb3a6",ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height),this.time+=t,this.decor.update(t),this.hero.update(t),i<=0?(this.spawner.update(t,this.time),this.attacks.update(t,this.time),L(ctx,ct,20),ct>=20&&(ct=0,i=3,this.spawner.enemies=[],0,this.hero.e.x=65,this.hero.e.y=30)):(i-=t,Math.ceil(i)!=n&&(s=20),s+=.3,n=Math.ceil(i),J(330,80,Math.ceil(i),s)),D(ctx,60,100,"#f68687","#a15156","#faf1f0",0),D(ctx,50,100,"#84e3b3","#589572","#f0faf7",30),Q(this.spawner.enemies.length),j(At)):this.intro.update(t)}}let et=window.innerWidth,it=window.innerHeight,ht=!1,st=0,nt=0,at=Date.now(),ot=Date.now(),ct=0,rt=new O(0,0),lt=new O(0,0),xt=new T(0,0,0,0),ft=!1,dt=!1,yt=!1,ut=!1,gt=0,wt=new Image;wt.src="atlas.png";let mt=new tt,pt=!1,Ht=!0,Mt=!1,Et=!1,kt=!1,St=.1,vt=4,At=60,bt=0,It=0;var Rt=800,Lt=600,Dt=window.innerWidth,Tt=window.innerHeight,Wt=Math.max(Dt/Rt,Tt/Lt),Ct=1;function startGame(){Pt.start(),Vt(this.ctx)}let Pt={canvas:document.createElement("canvas"),start:function(){this.canvas.width=Rt*Wt,this.canvas.height=Lt*Wt,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),this.context.setTransform(Wt,0,0,Wt,0,0),ctx=this.context,ctx.mozImageSmoothingEnabled=!1,ctx.webkitImageSmoothingEnabled=!1,ctx.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameId=requestAnimationFrame(Bt),window.addEventListener("keydown",function(t){St<=0&&3==st&&(pt=!0),t.preventDefault(),Pt.keys=Pt.keys||[],Pt.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){Pt.keys[t.keyCode]="keydown"==t.type,t.keyCode==v&&(yt=!0),t.keyCode==g&&(Mt=!Mt),t.keyCode==A&&(mt.tips=!mt.tips)}),window.addEventListener("mouseup",function(t){t.preventDefault(),Qt(),ft=!0,0===t.button?Et=!1:2===t.button&&(kt=!1)}),window.addEventListener("mousedown",function(t){t.preventDefault(),0===t.button?Et=!0:2===t.button&&(kt=!0)}),window.addEventListener("resize",Vt),window.addEventListener("mousemove",function(t){t.preventDefault();var e=Pt.canvas.getBoundingClientRect();rt.set((t.clientX-e.left)/(e.right-e.left)*et,(t.clientY-e.top)/(e.bottom-e.top)*it)}),this.canvas.oncontextmenu=function(t){t.preventDefault()}},stop:function(){Pt.frameId&&(cancelAnimationFrame(Pt.frameId),Pt.frameId=null)},clear:function(){this.context.clearRect(0,0,4*this.canvas.width,4*this.canvas.height)}},Ot=null;function Bt(t){Ot||(Ot=t);let e=(t-Ot)/1e3;Ot=t,bt++,(It+=e)>=1&&(At=bt/It,bt=0,It=0),Yt(e),j(At),Pt.frameId=requestAnimationFrame(Bt)}function Yt(t){dt&&(ct=0,dt=!1,ut=!1,gt=0,pt=!1,ht=!1,St=3),pt&&(ht=!0),St>0&&(St-=t),mt.update(t,ht),ft=!1}function Gt(){return Pt.keys&&(Pt.keys[n]||Pt.keys[d])}function Nt(){return Pt.keys&&(Pt.keys[a]||Pt.keys[u])}function Kt(){return Pt.keys&&(Pt.keys[o]||Pt.keys[f])}function Ut(){return Pt.keys&&(Pt.keys[l]||Pt.keys[y])}function Ft(){return Pt.keys&&Pt.keys[p]||Et}function Xt(){return Pt.keys&&Pt.keys[x]||kt}function qt(){return Pt.keys&&Pt.keys[M]}function $t(){return Pt.keys&&Pt.keys[E]}function zt(){return Pt.keys&&Pt.keys[k]}function Jt(){return Pt.keys&&Pt.keys[S]}function jt(){return Pt.keys&&Pt.keys[A]}function Qt(){lt.set(rt.x,rt.y),xt.x=rt.x-5,xt.y=rt.y+5,xt.h=10,xt.w=10,console.log(lt)}function Vt(){Dt=window.innerWidth,Tt=window.innerHeight,Wt=Math.max(Dt/Rt,Tt/Lt),ctx.canvas.width=Rt*Wt,ctx.canvas.height=Lt*Wt,this.context=ctx.canvas.getContext("2d"),this.context.setTransform(Wt,0,0,Wt,0,0),this.ctx.mozImageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1}