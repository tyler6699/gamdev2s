var t,n=!1,e=!1,i={songData:[{i:[2,96,128,0,2,8,164,0,0,5,12,44,43,0,0,0,0,69,3,1,1,26,116,0,32,0,6,76,6],p:[1,3,1,4,5,6,7,8],c:[{n:[147,,,,,,,,150,,,,,,,,149,,,,,,150,149,147,,,,,,145],f:[]},{n:[],f:[]},{n:[147,,,,,,145,147,149,,,,,,147,145,147],f:[]},{n:[147,,,,,,145,147,149,,,,,,150,152,154,,,,,,,,153],f:[]},{n:[154,,,,,,,,157,,,,,,156,157,159,,,,,,,,154,,,,,,152],f:[]},{n:[154,,,,,,,,157,,,,,,156,157,159,,,,,,,,,,,,,,161],f:[]},{n:[162,,,,,,,,,,,,,,161,162,164,,,,,,,,,,,,,,161,164],f:[]},{n:[166,,,,,,,,,,,,,,,173,173],f:[]}]},{i:[3,61,128,0,3,63,128,0,0,9,17,40,72,0,0,0,1,178,7,0,2,255,15,0,32,83,8,84,8],p:[11,12,11,14,13,13,15,16],c:[{n:[],f:[]},{n:[147,,,,147,,,,147,,,,147,,,,147,,,,147,,,,147,,,,147],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[135,,,,,,,,,,,,,,,,135,,,,,,,,,,,,,,,,138,,,,,,,,,,,,,,,,140,,,,,,,,,,,,,,,,142,,,,,,,,,,,,,,,,144],f:[]},{n:[131,,,,,,,,133,,,,,,,,135,,,,,,,,,,,,,,,,135,,,,,,,,137,,,,,,,,139,,,,,,,,,,,,,,,,138,,,,,,,,140,,,,,,,,142],f:[]},{n:[142,,,,,,,,,,,,,,,,142,,,,,,,,,,,,,,,,145,,,,,,,,,,,,,,,,147,,,,,,,,,,,,,,,,149,,,,,,,,,,,,,,,,151],f:[]},{n:[131,,,,,,,,133,,,,,,,,138,,,,,,,,137,,,,,,,,135,,,,,,,,137,,,,,,,,142,,,,,,,,141,,,,,,,,138,,,,,,,,140,,,,,,,,145,,,,,,,,144],f:[]},{n:[138,,,,,,,,,,,,,,,,140,,,,,,,,,,,,,,,,142,,,,,,,,,,,,,,,,144,,,,,,,,,,,,,,,,145,,,,,,,,,,,,,,,,147],f:[]},{n:[142,,,,,,,,,,,,,,,,142,,,,,,,,,,,,,,,,147,,,,,,,,,,,,,,,,146,,,,,,,,,,,,,,,,149,,,,,,,,,,,,,,,,149],f:[]}]},{i:[1,0,128,0,1,0,128,9,0,37,13,5,20,0,0,0,0,0,0,0,2,255,0,0,32,47,3,0,1],p:[17,17,17,17,17,17,17,17],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[147,,147,147,147,,147,147,147,,147,147,147,,147,147,147,,147,147,147,,147,147,147,,147,147,147,,147,147],f:[]}]},{i:[0,99,116,79,0,53,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[18,18,18,18,18,18,18,18],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[135,,,,135,,,,137,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[2,83,128,0,3,182,128,0,0,0,0,6,29,0,0,0,0,0,0,0,3,5,184,119,244,147,6,0,0],p:[19,20,19,21,22,22,23,24],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[111,,111,111,111,,111,111,111,,111,111,111,,111,,104,,104,104,104,,104,104,104,,104,104,104,,106],f:[]},{n:[107,,107,107,107,,107,107,109,,109,109,109,,109,109,111,,111,111,111,,111,111,111,,111,111,111,,111],f:[]},{n:[107,,107,107,107,,107,107,109,,109,109,109,,109,109,114,,114,114,114,,114,114,113,,113,113,113,114,115,116],f:[]},{n:[118,,118,118,118,,118,118,118,,118,118,118,,118,,111,,111,111,111,,111,111,111,,111,111,111,113,114,116],f:[]},{n:[114,,114,114,114,,114,114,114,,114,114,114,,114,114,116,,116,116,116,,116,116,116,,116,116,116,,116],f:[]},{n:[118,,118,118,118,,118,118,118,,118,118,118,,113,,118,,118,118,118,,118,118,118,,118,118,118,116,114,113],f:[]}]}],rowLen:4562,patternLen:32,endPattern:7,numChannels:5},h=function(){var t,n,e,i,s,h=function(t){return Math.sin(6.283184*t)},a=function(t){return.003959503758*2**((t-128)/12)},o=function(t,n,e){var i,s,h,o,f,c,l=r[t.i[0]],u=t.i[1],d=t.i[3]/32,y=r[t.i[4]],m=t.i[5],w=t.i[8]/32,x=t.i[9],g=t.i[10]*t.i[10]*4,v=t.i[11]*t.i[11]*4,p=t.i[12]*t.i[12]*4,k=1/p,S=-t.i[13]/16,b=t.i[14],M=e*2**(2-t.i[15]),I=new Int32Array(g+v+p),E=0,A=0;for(i=0,s=0;i<g+v+p;i++,s++)s>=0&&(s-=M,f=a(n+(15&(b=b>>8|(255&b)<<4))+t.i[2]-128),c=a(n+(15&b)+t.i[6]-128)*(1+8e-4*t.i[7])),h=1,i<g?h=i/g:i>=g+v&&(h=(1-(h=(i-g-v)*k))*3**(S*h)),o=l(E+=f*h**d)*u,o+=y(A+=c*h**w)*m,x&&(o+=(2*Math.random()-1)*x),I[i]=80*o*h|0;return I},r=[h,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var n=t%1*4;return n<2?n-1:3-n}];this.init=function(h){t=h,n=h.endPattern,e=0,i=h.rowLen*h.patternLen*(n+1)*2,s=new Int32Array(i)},this.generate=function(){var a,f,c,l,u,d,y,m,w,x,g,v,p,k,S=new Int32Array(i),b=t.songData[e],M=t.rowLen,I=t.patternLen,E=0,A=0,L=!1,W=[];for(c=0;c<=n;++c)for(y=b.p[c],l=0;l<I;++l){var H=y?b.c[y-1].f[l]:0;H&&(b.i[H-1]=b.c[y-1].f[l+I]||0,H<17&&(W=[]));var R=r[b.i[16]],P=b.i[17]/512,D=2**(b.i[18]-9)/M,C=b.i[19],T=b.i[20],Y=43.23529*b.i[21]*3.141592/44100,B=1-b.i[22]/255,X=1e-5*b.i[23],O=b.i[24]/32,z=b.i[25]/512,F=6.283184*2**(b.i[26]-9)/M,N=b.i[27]/255,U=b.i[28]*M&-2;for(g=(c*I+l)*M,u=0;u<4;++u)if(d=y?b.c[y-1].n[l+u*I]:0){W[d]||(W[d]=o(b,d,M));var j=W[d];for(f=0,a=2*g;f<j.length;f++,a+=2)S[a]+=j[f]}for(f=0;f<M;f++)(x=S[m=2*(g+f)])||L?(v=Y,C&&(v*=R(D*m)*P+.5),A+=(v=1.5*Math.sin(v))*(p=B*(x-A)-(E+=v*A)),x=3==T?A:1==T?p:E,X&&(x=(x*=X)<1?x>-1?h(.25*x):-1:1,x/=X),L=(x*=O)*x>1e-5,k=x*(1-(w=Math.sin(F*m)*z+.5)),x*=w):k=0,m>=U&&(k+=S[m-U+1]*N,x+=S[m-U]*N),S[m]=0|k,S[m+1]=0|x,s[m]+=0|k,s[m+1]+=0|x}return++e/t.numChannels},this.createAudioBuffer=function(t){for(var n=t.createBuffer(2,i/2,44100),e=0;e<2;e++)for(var h=n.getChannelData(e),a=e;a<i;a+=2)h[a>>1]=s[a]/65536;return n},this.createWave=function(){var t=44+2*i-8,n=t-36,e=new Uint8Array(44+2*i);e.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&n,n>>8&255,n>>16&255,n>>24&255]);for(var h=0,a=44;h<i;++h){var o=s[h];o=o<-32767?-32767:o>32767?32767:o,e[a++]=255&o,e[a++]=o>>8&255}return e},this.getData=function(t,n){for(var e=2*Math.floor(44100*t),i=new Array(n),h=0;h<2*n;h+=1){var a=e+h;i[h]=t>0&&a<s.length?s[a]/32768:0}return i}};function a(){var s=new h;s.init(i),setInterval(function(){if(!n&&(n=s.generate()>=1)){var i=s.createWave();(t=document.createElement("audio")).src=URL.createObjectURL(new Blob([i],{type:"audio/wav"})),e=!0}},0)}function o(t=0,n=0){this.x=t,this.y=n}function f(){this.cam=new o,this.tips=!0,this.time=0,this.reset=!1,this.hero=new W(16,16,0,0,0,l.HERO),this.attacks=new Attack(this.hero),this.spawner=new Spawner(this.hero),this.intro=new Intro,this.update=function(t,n=!1){if(n){this.cam.x=k(350-this.hero.x,this.cam.x,.1),this.cam.y=k(200-this.hero.y,this.cam.y,.1),Y+=t,ht.clear(),this.time+=t,this.hero.update(t),this.spawner.update(t,this.time),this.attacks.update(t,this.time),y(ctx,100,100,"red",0),y(ctx,50,100,"lime",30),d(ctx,Y,5);let n=5;ft()&&(this.hero.x-=n),ct()&&(this.hero.x+=n),lt()&&(this.hero.y-=n),ut()&&(this.hero.y+=n)}else this.intro.update()}}const l={AIR:0,GRASS:1,HERO:2,ENEMY:3,SHIELD:4};function u(t,n,e,i,s,h,a,o,r,f){this.id=t,this.obj=null,this.e=new entity(n,n,e,i,s,h,"",f,0,0),this.column=o,this.row=r,this.active=!0,this.update=function(t){this.e.update(t)}}function d(t,n,e){angle=2*Math.PI*(n/e),n>=e&&(angle=2*Math.PI),t.beginPath(),t.fillStyle="#cccccc",t.moveTo(300,50),t.arc(300,50,20,0,2*Math.PI),t.closePath(),t.fill(),t.beginPath(),t.fillStyle="white",t.moveTo(300,50),t.arc(300,50,20,-Math.PI/2,angle-Math.PI/2,!1),t.closePath(),t.fill(),t.beginPath(),t.moveTo(300,50),t.lineTo(300+20*Math.cos(angle-Math.PI/2),50+20*Math.sin(angle-Math.PI/2)),t.strokeStyle="#000000",t.lineWidth=3,t.stroke()}function y(t,n,e,i,s){t.save(),t.translate(0,s);t.fillStyle="black",t.fillRect(10,10,200,20);const h=200*(n/e);t.fillStyle="grey",t.fillRect(12,12,196,16),t.fillStyle=i,t.fillRect(12,12,h-4,16),t.font="14px Arial",t.fillStyle="white",t.textAlign="center",t.textBaseline="middle";t.fillText(`${n} / ${e}`,110,20),t.restore()}function m(t,n,e,i){this.x=t,this.y=n,this.w=e,this.h=i}function w(t,n){return Math.floor(Math.random()*(n-t+1)+t)}function x(t){return new m(t.x,t.y,t.w,t.h)}function g(t,n){return t.x<n.x+n.w&&t.x+t.w>n.x&&t.y<n.y+n.h&&t.y+t.h>n.y}function v(t,n){this.x=t,this.y=n,this.set=function(t,n){this.x=t,this.y=n}}function p(t,n,e,i,s,h,a,o,r){t.save(),t.globalAlpha=r,t.translate(n,e),t.fillStyle=o,t.fillRect(i,s,h,a),t.restore()}function k(t,n,e){return(1-e)*t+e*n}function S(t,n){return cenX=Math.floor(t/2),cenY=Math.floor(n/2),{x:16*(cenX-cenY)/2,y:16*(cenX+cenY)/2}}function b(t){const n=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0);return Math.round(n*t)}function M(t,n,e,i,s,h,a){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=n,t.fillStyle=e,t.fillRect(i,s,h,a),t.restore()}function I(t,n,e,i,s,h,a){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=n,t.font=e,t.fillStyle=i,t.fillText(s,h,a),t.restore()}function E(t,n,e,i){let s=t/32,h=(n+2*e+i)/32*2,a=h-s,o=s+h;return r=Math.floor(a),c=Math.floor(o),A(r,c)}function A(t,n){return G.level.tiles[n+G.levels[G.hero.e.curLevel].cols*t]}function L(t,n,e){let i=t.e.x>n.x?1:-1,s=t.e.y>n.y?1:-1;t.e.x+=i*e,t.e.y+=s*e}function W(t,n,e,i,h,a){this.type=a,this.width=t,this.height=n,this.mhWidth=t/-2,this.mhHeight=n/-2,this.mhWScld=t/-2,this.mhHScld=n/-2,this.hWidth=t/2,this.hHeight=n/2,this.cenX=e-this.mhWScld,this.cenY=i-this.mhHScld,this.angle=h,this.x=e,this.y=i,this.image=q,this.alpha=1,this.isSolid=!1,this.sx=0,this.sy=0,this.update=function(e){this.x=Math.floor(this.x),this.Y=Math.floor(this.Y),ctx.save(),ctx.translate(this.x,this.y),ctx.globalAlpha=this.alpha,img=this.image,s=this.scale,mhw=this.mhWidth,mhh=this.mhHeight,hw=this.hWidth,hh=this.hHeight,t=this.width,n=this.height,ctx.translate(G.cam.x,G.cam.y),ctx.scale(_,_),ctx.drawImage(img,this.sx,this.sy,t,n,hw,hh,t,n),ctx.restore(),this.cenX=this.x-this.mhWScld,this.cenY=this.y-this.mhHScld},this.isCollidingWith=function(t){return!(this.x+this.width<t.x-t.width||this.x-this.width>t.x+t.width||this.y+this.height<t.y-t.height||this.y-this.height>t.y+t.height)},this.setType=function(){switch(this.alpha=1,this.sy=0,this.sx=0,this.type){case l.HERO:break;case l.ENEMY:case l.GRASS:this.sx=16;break;case l.SHIELD:this.sx=33}},this.setType()}let H=window.innerWidth,R=window.innerHeight,P=!1,D=0,C=Date.now(),T=Date.now(),Y=0,B=new v(0,0),X=new v(0,0),O=new m(0,0,0,0),z=!1,F=!1,N=!1,U=!1,j=0,q=new Image;q.src="atlas.png";let G=new f,$=!1,J=!0,K=!1,Q=!1,V=!1,Z=.1,_=4;var tt=800,nt=600,et=window.innerWidth,it=window.innerHeight,st=Math.max(et/tt,it/nt);function startGame(){ht.start(),kt(this.ctx)}let ht={canvas:document.createElement("canvas"),start:function(){this.canvas.width=tt*st,this.canvas.height=nt*st,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),this.context.setTransform(st,0,0,st,0,0),ctx=this.context,ctx.mozImageSmoothingEnabled=!1,ctx.webkitImageSmoothingEnabled=!1,ctx.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameId=requestAnimationFrame(ot),window.addEventListener("keydown",function(t){Z<=0&&($=!0),t.preventDefault(),ht.keys=ht.keys||[],ht.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){ht.keys[t.keyCode]="keydown"==t.type,t.keyCode==zt&&(N=!0),t.keyCode==Rt&&(K=!K),t.keyCode==Ft&&(G.tips=!G.tips)}),window.addEventListener("mouseup",function(t){t.preventDefault(),pt(),z=!0,0===t.button?Q=!1:2===t.button&&(V=!1)}),window.addEventListener("mousedown",function(t){t.preventDefault(),0===t.button?Q=!0:2===t.button&&(V=!0)}),window.addEventListener("resize",kt),window.addEventListener("mousemove",function(t){t.preventDefault();var n=ht.canvas.getBoundingClientRect();B.set((t.clientX-n.left)/(n.right-n.left)*H,(t.clientY-n.top)/(n.bottom-n.top)*R)}),this.canvas.oncontextmenu=function(t){t.preventDefault()}},stop:function(){ht.frameId&&(cancelAnimationFrame(ht.frameId),ht.frameId=null)},clear:function(){this.context.clearRect(0,0,4*this.canvas.width,4*this.canvas.height)}},at=null;function ot(t){at||(at=t);let n=(t-at)/1e3;at=t,rt(n),ht.frameId=requestAnimationFrame(ot)}function rt(t){F&&(Y=0,F=!1,U=!1,j=0,$=!1,P=!1,Z=3),$&&(P=!0),Z>0&&(Z-=t),G.update(t,P),z=!1}function ft(){return ht.keys&&(ht.keys[St]||ht.keys[Lt])}function ct(){return ht.keys&&(ht.keys[bt]||ht.keys[Ht])}function lt(){return ht.keys&&(ht.keys[Mt]||ht.keys[At])}function ut(){return ht.keys&&(ht.keys[It]||ht.keys[Wt])}function dt(){return ht.keys&&ht.keys[Ct]||Q}function yt(){return ht.keys&&ht.keys[Et]||V}function mt(){return ht.keys&&ht.keys[Yt]}function wt(){return ht.keys&&ht.keys[Bt]}function xt(){return ht.keys&&ht.keys[Xt]}function gt(){return ht.keys&&ht.keys[Ot]}function vt(){return ht.keys&&ht.keys[Ft]}function pt(){X.set(B.x,B.y),O.x=B.x-5,O.y=B.y+5,O.h=10,O.w=10,console.log(X)}function kt(){et=window.innerWidth,it=window.innerHeight,st=Math.max(et/tt,it/nt),ctx.canvas.width=tt*st,ctx.canvas.height=nt*st,this.context=ctx.canvas.getContext("2d"),this.context.setTransform(st,0,0,st,0,0),this.ctx.mozImageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1}var St=37,bt=39,Mt=38,It=40,Et=16,At=87,Lt=65,Wt=83,Ht=68,Rt=77,Pt=0,Dt=2,Ct=32,Tt=69,Yt=49,Bt=50,Xt=51,Ot=52,zt=82,Ft=84;