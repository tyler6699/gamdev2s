function t(t){this.hero=t;this.enemies=[];for(let t=0;t<20;t++){let i=t/20*2*Math.PI,n=new e(16,16,H.ENEMY,t,20);n.e.x=this.hero.x+600*Math.cos(i),n.e.y=this.hero.y+600*Math.sin(i),this.enemies.push(n)}this.update=function(t,e){this.enemies.forEach(e=>{e.update(t,this.enemies),e.e.update(t)})}}function e(t,e,i,n,s){this.e=new b(16,16,0,0,0,i),this.speed=.8,this.angleOffset=2*Math.PI*(n/s),this.update=function(t,e){let i=this.steerFromNearbyMobs(e,60),n=yt.hero.x+50*Math.cos(this.angleOffset),s=yt.hero.y+50*Math.sin(this.angleOffset);this.e.x+=(n-this.e.x>0?this.speed:-this.speed)+i.x,this.e.y+=(s-this.e.y>0?this.speed:-this.speed)+i.y,this.e.isCollidingWith(yt.hero)&&(console.log("Enemy is touching the hero!"),this.e.x+=1e3)},this.steerFromNearbyMobs=function(t,e){let i=0,n=0,s=0;for(let h=0;h<t.length;h++){let a=t[h],o=Math.sqrt(Math.pow(this.e.x-a.e.x,2)+Math.pow(this.e.y-a.e.y,2));a!==this&&o<e&&(i+=this.e.x-a.e.x,n+=this.e.y-a.e.y,s++)}s>0&&(i/=s,n/=s);let h=Math.sqrt(i*i+n*n);return h>0&&(i/=h,n/=h),{x:i,y:n}}}function i(t=0,e=0){this.x=t,this.y=e}var n=37,h=39,a=38,o=40,l=16,y=87,u=65,f=83,d=68,x=77,g=0,m=2,w=32,p=69,E=49,k=50,M=51,v=52,S=82,I=84;function b(t,e,i,n,h,a){this.type=a,this.width=t,this.height=e,this.mhWidth=t/-2,this.mhHeight=e/-2,this.mhWScld=t/-2,this.mhHScld=e/-2,this.hWidth=t/2,this.hHeight=e/2,this.cenX=i-this.mhWScld,this.cenY=n-this.mhHScld,this.angle=h,this.x=i,this.y=n,this.image=lt,this.alpha=1,this.isSolid=!1,this.sx=0,this.sy=0,this.move=function(){Wt()&&(this.x-=5),Pt()&&(this.x+=5),Tt()&&(this.y-=5),Rt()&&(this.y+=5)},this.update=function(i){this.x=Math.floor(this.x),this.Y=Math.floor(this.Y),ctx.save(),ctx.translate(this.x,this.y),ctx.globalAlpha=this.alpha,img=this.image,s=this.scale,mhw=this.mhWidth,mhh=this.mhHeight,hw=this.hWidth,hh=this.hHeight,t=this.width,e=this.height,ctx.translate(yt.cam.x,yt.cam.y),ctx.scale(wt,wt),ctx.drawImage(img,this.sx,this.sy,t,e,hw,hh,t,e),ctx.restore(),this.cenX=this.x-this.mhWScld,this.cenY=this.y-this.mhHScld},this.isCollidingWith=function(t){return!(this.x+this.width<t.x-t.width||this.x-this.width>t.x+t.width||this.y+this.height<t.y-t.height||this.y-this.height>t.y+t.height)},this.setType=function(){switch(this.alpha=1,this.sy=0,this.sx=0,this.type){case H.HERO:break;case H.ENEMY:case H.GRASS:this.sx=16;break;case H.SHIELD:this.sx=33}},this.setType()}const H={AIR:0,GRASS:1,HERO:2,ENEMY:3,SHIELD:4};function W(t,e,i){angle=2*Math.PI*(e/i),e>=i&&(angle=2*Math.PI),t.beginPath(),t.fillStyle="#cccccc",t.moveTo(300,50),t.arc(300,50,20,0,2*Math.PI),t.closePath(),t.fill(),t.beginPath(),t.fillStyle="white",t.moveTo(300,50),t.arc(300,50,20,-Math.PI/2,angle-Math.PI/2,!1),t.closePath(),t.fill(),t.beginPath(),t.moveTo(300,50),t.lineTo(300+20*Math.cos(angle-Math.PI/2),50+20*Math.sin(angle-Math.PI/2)),t.strokeStyle="#000000",t.lineWidth=3,t.stroke()}function P(t,e,i,n,s){t.save(),t.translate(0,s);t.fillStyle="black",t.fillRect(10,10,200,20);const h=200*(e/i);t.fillStyle="grey",t.fillRect(12,12,196,16),t.fillStyle=n,t.fillRect(12,12,h-4,16),t.font="14px Arial",t.fillStyle="white",t.textAlign="center",t.textBaseline="middle";t.fillText(`${e} / ${i}`,110,20),t.restore()}function T(t,e,i,n){this.x=t,this.y=e,this.w=i,this.h=n}function R(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function L(t){return new T(t.x,t.y,t.w,t.h)}function D(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y}function A(t,e){this.x=t,this.y=e,this.set=function(t,e){this.x=t,this.y=e}}function C(t,e,i,n,s,h,a,o,c){t.save(),t.globalAlpha=c,t.translate(e,i),t.fillStyle=o,t.fillRect(n,s,h,a),t.restore()}function Y(t,e,i){return(1-i)*t+i*e}function N(t,e){return cenX=Math.floor(t/2),cenY=Math.floor(e/2),{x:16*(cenX-cenY)/2,y:16*(cenX+cenY)/2}}function O(t){const e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0);return Math.round(e*t)}function X(t,e,i,n,s,h,a){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=e,t.fillStyle=i,t.fillRect(n,s,h,a),t.restore()}function q(t,e,i,n,s,h,a){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=e,t.font=i,t.fillStyle=n,t.fillText(s,h,a),t.restore()}function F(t,e,i,n){let s=t/32,h=(e+2*i+n)/32*2,a=h-s,o=s+h;return r=Math.floor(a),c=Math.floor(o),G(r,c)}function G(t,e){return yt.level.tiles[e+yt.levels[yt.hero.e.curLevel].cols*t]}function z(t,e,i){let n=t.e.x>e.x?1:-1,s=t.e.y>e.y?1:-1;t.e.x+=n*i,t.e.y+=s*i}const B={0:[[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1]],1:[[0,0,1,0,0],[0,1,1,0,0],[1,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],2:[[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1]],3:[[1,1,1,1,1],[0,0,0,0,1],[0,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]],4:[[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[0,0,0,0,1],[0,0,0,0,1]],5:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]],6:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1]],7:[[1,1,1,1,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[0,1,0,0,0]],8:[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1]],9:[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]]};function $(t,e,i,n){for(let s=0;s<B[i].length;s++)for(let h=0;h<B[i][s].length;h++)1===B[i][s][h]&&(ctx.fillStyle="white",ctx.fillRect(t+h*n,e+s*n,n,n))}function j(t){this.hero=t,this.rotatingEntity=new b(8,8,0,0,0,H.SHIELD),this.spinningEntity=new b(4,4,0,0,0,H.SHIELD),this.chasingEntity=new b(8,8,0,0,0,H.SHIELD),this.helicalEntity=new b(8,8,0,0,0,H.SHIELD),this.figureEightEntity=new b(4,4,0,0,0,H.SHIELD),this.rotate=!1,this.spin=!1,this.chase=!1,this.loop=!1,this.update=function(t,e){if(this.rotate){let i=60,n=2,s=2*e*Math.PI/n;this.rotatingEntity.x=this.hero.x+32+i*Math.cos(s),this.rotatingEntity.y=this.hero.y+32+i*Math.sin(s),this.rotatingEntity.update(t)}if(this.spin){let i=60,n=2*e*Math.PI/.6;this.spinningEntity.x=this.rotatingEntity.x+16+i*Math.cos(n),this.spinningEntity.y=this.rotatingEntity.y+16+i*Math.sin(n),this.spinningEntity.update(t)}if(this.rotate){let e=.1,i=this.hero.x-this.chasingEntity.x,n=this.hero.y-this.chasingEntity.y;Math.sqrt(i*i+n*n)>1&&(this.chasingEntity.x+=e*i,this.chasingEntity.y+=e*n),this.chasingEntity.update(t)}if(this.loop){radius=80;let i=2,n=this.hero.x+32+radius*Math.sin(e*i),s=this.hero.y+50+radius*Math.sin(2*e*i);this.figureEightEntity.x=n,this.figureEightEntity.y=s,this.figureEightEntity.update(t)}}}function J(){this.update=function(){let t=O(.05);St.clear(),ctx.save(),X(ctx,.8,"black",0,0,Q,U);let e=`${t}px Arial`;q(ctx,1,e,"WHITE","Game Title",30,90),q(ctx,1,e,"WHITE",mt>0?"Generating World ..":"Press any key to start",30,U-120),q(ctx,1,e,"WHITE","INTRO SCREEN "+et,30,200),ctx.restore()}}function K(){this.cam=new i,this.tips=!0,this.time=0,this.reset=!1,this.hero=new b(16,16,0,0,0,H.HERO),this.attacks=new j(this.hero),this.spawner=new t(this.hero),this.intro=new J;let e=3,n=20,s=0;this.update=function(t,i=!1){i?(this.cam.x=Y(350-this.hero.x,this.cam.x,.1),this.cam.y=Y(200-this.hero.y,this.cam.y,.1),et+=t,St.clear(),this.time+=t,this.hero.move(t),this.hero.update(t),P(ctx,100,100,"red",0),P(ctx,50,100,"lime",30),e<=0?(W(ctx,et,10),this.spawner.update(t,this.time),this.attacks.update(t,this.time),et>=10&&(et=0,e=3,this.spawner.enemies=[])):(e-=t,Math.ceil(e)!=s&&(n=20),n+=.3,s=Math.ceil(e),$(330,80,Math.ceil(e),n))):this.intro.update()}}let Q=window.innerWidth,U=window.innerHeight,V=!1,Z=0,_=Date.now(),tt=Date.now(),et=0,it=new A(0,0),nt=new A(0,0),st=new T(0,0,0,0),ht=!1,at=!1,ot=!1,ct=!1,rt=0,lt=new Image;lt.src="atlas.png";let yt=new K,ut=!1,ft=!0,dt=!1,xt=!1,gt=!1,mt=.1,wt=4;var pt=800,Et=600,kt=window.innerWidth,Mt=window.innerHeight,vt=Math.max(kt/pt,Mt/Et);function startGame(){St.start(),qt(this.ctx)}let St={canvas:document.createElement("canvas"),start:function(){this.canvas.width=pt*vt,this.canvas.height=Et*vt,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),this.context.setTransform(vt,0,0,vt,0,0),ctx=this.context,ctx.mozImageSmoothingEnabled=!1,ctx.webkitImageSmoothingEnabled=!1,ctx.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameId=requestAnimationFrame(bt),window.addEventListener("keydown",function(t){mt<=0&&(ut=!0),t.preventDefault(),St.keys=St.keys||[],St.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){St.keys[t.keyCode]="keydown"==t.type,t.keyCode==S&&(ot=!0),t.keyCode==x&&(dt=!dt),t.keyCode==I&&(yt.tips=!yt.tips)}),window.addEventListener("mouseup",function(t){t.preventDefault(),Xt(),ht=!0,0===t.button?xt=!1:2===t.button&&(gt=!1)}),window.addEventListener("mousedown",function(t){t.preventDefault(),0===t.button?xt=!0:2===t.button&&(gt=!0)}),window.addEventListener("resize",qt),window.addEventListener("mousemove",function(t){t.preventDefault();var e=St.canvas.getBoundingClientRect();it.set((t.clientX-e.left)/(e.right-e.left)*Q,(t.clientY-e.top)/(e.bottom-e.top)*U)}),this.canvas.oncontextmenu=function(t){t.preventDefault()}},stop:function(){St.frameId&&(cancelAnimationFrame(St.frameId),St.frameId=null)},clear:function(){this.context.clearRect(0,0,4*this.canvas.width,4*this.canvas.height)}},It=null;function bt(t){It||(It=t);let e=(t-It)/1e3;It=t,Ht(e),St.frameId=requestAnimationFrame(bt)}function Ht(t){at&&(et=0,at=!1,ct=!1,rt=0,ut=!1,V=!1,mt=3),ut&&(V=!0),mt>0&&(mt-=t),yt.update(t,V),ht=!1}function Wt(){return St.keys&&(St.keys[n]||St.keys[u])}function Pt(){return St.keys&&(St.keys[h]||St.keys[d])}function Tt(){return St.keys&&(St.keys[a]||St.keys[y])}function Rt(){return St.keys&&(St.keys[o]||St.keys[f])}function Lt(){return St.keys&&St.keys[w]||xt}function Dt(){return St.keys&&St.keys[l]||gt}function At(){return St.keys&&St.keys[E]}function Ct(){return St.keys&&St.keys[k]}function Yt(){return St.keys&&St.keys[M]}function Nt(){return St.keys&&St.keys[v]}function Ot(){return St.keys&&St.keys[I]}function Xt(){nt.set(it.x,it.y),st.x=it.x-5,st.y=it.y+5,st.h=10,st.w=10,console.log(nt)}function qt(){kt=window.innerWidth,Mt=window.innerHeight,vt=Math.max(kt/pt,Mt/Et),ctx.canvas.width=pt*vt,ctx.canvas.height=Et*vt,this.context=ctx.canvas.getContext("2d"),this.context.setTransform(vt,0,0,vt,0,0),this.ctx.mozImageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1}