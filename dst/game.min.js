var t,e=!1,i=!1,h={songData:[{i:[3,162,128,0,3,0,128,0,0,0,5,6,45,0,0,0,0,6,1,2,255,0,6,69,0,6,0,6],p:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,27,33,27,33,27,33,27,33],c:[{n:[113,,113,113,113,,113,113,,108,113,108,115,116,111,108,,113,113,,113,,113,113,,108,113,108,115,116,111,115],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[121,,121,121,121,,121,121,,116,121,116,123,125,116,121,,120,120,,120,,120,120,,111,115,111,118,120,123,125],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[118,,118,118,118,,118,118,,113,118,113,120,121,123,115,,115,115,,115,,115,115,,113,111,113,115,116,118,120],f:[]}]},{i:[0,119,128,1,3,0,128,0,0,0,0,0,43,0,0,0,0,6,1,2,255,117,3,212,0,6,0,6],p:[,,,,2,2,2,,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],c:[{n:[],f:[]},{n:[125,,,125,,,125,125,,,125,,,,,,,,125,125,,,,125,,,125],f:[]}]},{i:[2,0,128,0,3,0,128,0,0,196,5,6,41,0,0,0,0,6,1,2,149,0,0,116,0,6,27,6],p:[,,,7,3,3,3,7,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],c:[{n:[],f:[]},{n:[],f:[]},{n:[,,,,137,,,,,,,,137,,,,,,,,137,,,,,,,,137,,137,137],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,137,,137,137],f:[]}]},{i:[2,0,128,0,3,0,128,0,0,131,5,6,29,0,0,0,0,6,1,1,135,0,0,32,147,6,92,2],p:[,,4,8,4,4,4,8,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[185,,,185,,,185,,,185,,,185,185,,,185,,,185,,,185,,,185,,,185,185],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[185,,,185,,,185,,,185,,,185,185],f:[]}]},{i:[2,100,128,0,1,201,128,0,0,0,5,6,44,0,0,0,0,6,1,2,83,0,0,5,147,6,45,6],p:[,,,,5,5,5,5,5,5,5,5,5,5,5,5,11,29,11,29,11,29,11,29],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[137,137,137,,137,137,,137,,137,137,,137,137,,137,,125,125,,137,137,,137,,137,137,,137,137,,137,140,140,140,,140,140,,140,,140,140,,140,140,,140,,128,128,,140,140,,140,,140,140,,140,140,,140,144,144,144,,144,144,,144,,144,144,,144,144,,144,,132,132,,144,144,,144,,144,144,,144,144,,144,147,147,147,,147,147,,147,,147,147,,147,147,,147,,135,135,,147,147,,147,,147,147,,147,147,,147],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[137,137,137,,137,137,,137,,137,137,,137,137,,137,,123,123,,135,135,,135,,135,135,,135,135,,135,140,140,140,,140,140,,140,,140,140,,140,140,,140,,127,127,,139,139,,139,,139,139,,139,139,,139,144,144,144,,144,144,,144,,144,144,,144,144,,144,,130,130,,142,142,,142,,142,142,,142,142,,142,147,147,147,,147,147,,147,,147,147,,147,147,,147,,132,132,,144,144,,144,,144,144,,144,144,,144],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[137,137,137,,137,137,,137,,137,137,,137,137,,137,,123,123,,135,135,,135,,135,135,,135,135,,135,140,140,140,,140,140,,140,,140,140,,140,140,,140,,127,127,,139,139,,139,,139,139,,139,139,,139,142,142,142,,142,142,,142,,142,142,,142,142,,142,,130,130,,142,142,,142,,142,142,,142,142,,142,145,145,145,,145,145,,145,,145,145,,145,145,,145,,133,133,,145,145,,145,,145,145,,145,145,,145],f:[]}]},{i:[1,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,6,1,2,188,53,0,32,0,6,27,6],p:[,,,,,,,,6,9,6,10,6,9,6,10,36,34,13,32,36,34,13,32],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,152,,,,151,,147,,,,154,,,,152,,,,151,,,,147,,144,,142],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,152,,,,151,,147,,,,154,,,,156,,,,144,,154,,152,,151,,152],f:[]},{n:[,,,,152,,,,151,,147,,,,140,,151,,152,,142,,154,,156,,144,,159,,161],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,149,,,,152,,,,157,,,,159,,,,161,,159,,,,152,,163,,164],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,166,,164,,163,,159,,,,,,164,,163,,159,,156,,,,154,156,157,159,161,156,152,151],f:[]},{n:[],f:[]},{n:[,,157,,156,,152,,149,,,,147,,149,,151,,152,,151,,147,,142,140,139,140,142,144,145,147],f:[]},{n:[],f:[]},{n:[,,,,149,,,,152,,,,157,,,,159,,,,161,,159,,,,152,,156,,157],f:[]}]}],rowLen:5088,patternLen:32,endPattern:23,numChannels:6},n=function(){var t,e,i,s,h,n=function(t){return Math.sin(6.283184*t)},a=function(t){return.003959503758*Math.pow(2,(t-128)/12)},o=function(t,e,i){var s,h,n,o,c,l,f,d=r[t.i[0]],u=t.i[1],x=t.i[3],y=r[t.i[4]],p=t.i[5],m=t.i[8],w=t.i[9],g=t.i[10]*t.i[10]*4,E=t.i[11]*t.i[11]*4,M=t.i[12]*t.i[12]*4,v=1/M,k=t.i[13],H=i*Math.pow(2,2-t.i[14]),I=new Int32Array(g+E+M),b=0,S=0;for(s=0,h=0;s<g+E+M;s++,h++)h>=0&&(h-=H,l=a(e+(15&(k=k>>8|(255&k)<<4))+t.i[2]-128),f=a(e+(15&k)+t.i[6]-128)*(1+8e-4*t.i[7])),n=1,s<g?n=s/g:s>=g+E&&(n-=(s-g-E)*v),o=l,x&&(o*=n*n),c=d(b+=o)*u,o=f,m&&(o*=n*n),c+=y(S+=o)*p,w&&(c+=(2*Math.random()-1)*w),I[s]=80*c*n|0;return I},r=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}];this.init=function(n){t=n,e=n.endPattern,i=0,s=n.rowLen*n.patternLen*(e+1)*2,h=new Int32Array(s)},this.generate=function(){var a,c,l,f,d,u,x,y,p,m,w,g,E,M,v=new Int32Array(s),k=t.songData[i],H=t.rowLen,I=t.patternLen,b=0,S=0,A=!1,L=[];for(l=0;l<=e;++l)for(x=k.p[l],f=0;f<I;++f){var R=x?k.c[x-1].f[f]:0;R&&(k.i[R-1]=k.c[x-1].f[f+I]||0,R<16&&(L=[]));var C=r[k.i[15]],T=k.i[16]/512,P=Math.pow(2,k.i[17]-9)/H,W=k.i[18],D=k.i[19],B=43.23529*k.i[20]*3.141592/44100,O=1-k.i[21]/255,F=1e-5*k.i[22],G=k.i[23]/32,Y=k.i[24]/512,N=6.283184*Math.pow(2,k.i[25]-9)/H,U=k.i[26]/255,K=k.i[27]*H&-2;for(w=(l*I+f)*H,d=0;d<4;++d)if(u=x?k.c[x-1].n[f+d*I]:0){L[u]||(L[u]=o(k,u,H));var q=L[u];for(c=0,a=2*w;c<q.length;c++,a+=2)v[a]+=q[c]}for(c=0;c<H;c++)(m=v[y=2*(w+c)])||A?(g=B,W&&(g*=C(P*y)*T+.5),S+=(g=1.5*Math.sin(g))*(E=O*(m-S)-(b+=g*S)),m=3==D?S:1==D?E:b,F&&(m=(m*=F)<1?m>-1?n(.25*m):-1:1,m/=F),A=(m*=G)*m>1e-5,M=m*(1-(p=Math.sin(N*y)*Y+.5)),m*=p):M=0,y>=K&&(M+=v[y-K+1]*U,m+=v[y-K]*U),v[y]=0|M,v[y+1]=0|m,h[y]+=0|M,h[y+1]+=0|m}return++i/t.numChannels},this.createWave=function(){var t=44+2*s-8,e=t-36,i=new Uint8Array(44+2*s);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var n=0,a=44;n<s;++n){var o=h[n];o=o<-32767?-32767:o>32767?32767:o,i[a++]=255&o,i[a++]=o>>8&255}return i},this.getData=function(t,e){for(var i=2*Math.floor(44100*t),s=new Array(e),n=0;n<2*e;n+=1){var a=i+n;s[n]=t>0&&a<h.length?h[a]/32768:0}return s}};function a(){var s=new n;s.init(h),setInterval(function(){if(!e&&(e=s.generate()>=1)){var h=s.createWave();(t=document.createElement("audio")).src=URL.createObjectURL(new Blob([h],{type:"audio/wav"})),i=!0}},0)}function o(t,e,i,s,h,n,a,o=y){this.time=0,this.x=i,this.y=s,this.w=t,this.h=e,this.type=n,this.endPos=at(this),this.speed=5,this.angle=Math.atan2(this.endPos.y-this.y,this.endPos.x-this.x),this.remove=!1,this.alpha=1,this.colour="#"+["FF0000","B30000","7D0000","FF8080"][Y(0,3)],this.no=1,"dust"==this.type&&(this.colour="#"+["4d1933","EDEDED"][Y(0,1)],this.alpha=.1),this.rndCol=a,this.lastDir=o,this.update=function(t,e){if(this.time+=e,t.save(),t.translate(Lt.cam.x,Lt.cam.y),"circle"==this.type){let e=Math.atan2(this.y-this.endPos.y,this.x-this.endPos.x)+Math.PI+2*(Math.random()-.5);Math.hypot(this.endPos.x-this.x,this.endPos.y-this.y)>=10&&(this.x+=Math.cos(e)*this.speed-this.time,this.y+=Math.sin(e)*this.speed-this.time),this.alpha-=.01,this.w>1&&(this.w-=.75),t.beginPath(),t.globalAlpha=this.alpha,t.arc(this.x,this.y,this.w,0,6.283185307179586);let i=this.rndCol?ot():this.colour;t.fillStyle=i,t.fill(),this.time>.6&&(this.remove=!0)}else"dust"==this.type&&(this.lastDir==y?this.x-=2:this.x+=2,this.y-=Y(1,5)/10,t.beginPath(),t.globalAlpha=this.alpha,t.arc(this.x,this.y,this.w,0,6.283185307179586),t.fillStyle=this.colour,t.fill(),this.alpha>.1&&(this.alpha-=.01),this.w+=.1,this.time>.5&&(this.remove=!0));t.globalAlpha=1,t.restore()}}function l(){this.decors=[];var t=60;for(let e=0;e<t;e++){let t=4e3*Math.random()-2e3,e=4e3*Math.random()-2e3;this.decors.push(new W(9,6,t,e,0,B.SMALLROCK))}numRocks=50;for(let e=0;e<t;e++){let t=4e3*Math.random()-2e3,e=4e3*Math.random()-2e3;this.decors.push(new W(14,10,t,e,0,B.BIGROCK))}t=30;for(let e=0;e<t;e++){let t=4e3*Math.random()-2e3,e=4e3*Math.random()-2e3;this.decors.push(new W(14,14,t,e,0,B.STUMP))}t=20;for(let e=0;e<t;e++){let t=4e3*Math.random()-2e3,e=4e3*Math.random()-2e3;this.decors.push(new W(10,9,t,e,0,B.BIGMUSH))}t=40;for(let e=0;e<t;e++){let t=4e3*Math.random()-2e3,e=4e3*Math.random()-2e3;this.decors.push(new W(7,7,t,e,0,B.SMALLMUSH))}this.update=function(t,e){this.decors.forEach(e=>{e.update(t)})}}function f(t){this.hero=t,this.enemies=[],this.update=function(t,e){this.enemies.forEach(e=>{e.update(t,this.enemies),e.e.update(t)}),this.enemies=this.enemies.filter(function(t){return t.active})},this.addEnemy=function(t,e){for(let i=0;i<t;i++){let s=i/t*2*Math.PI,h=new d(0,0,9,8,[B.LILY,B.LILG,B.LILP][Y(0,2)],i,t);h.e.x=this.hero.x+e*Math.cos(s),h.e.y=this.hero.y+e*Math.sin(s),this.enemies.push(h)}},this.addEnemy(200,600)}function d(t,e,i,s,h,n,a){this.active=!0,this.e=new W(i,s,0,0,0,h),this.speed=.8,this.angleOffset=2*Math.PI*(n/a),this.safe=0,this.update=function(t,e){this.safe>0&&(this.safe-=t);let i=this.steerFromNearbyMobs(e,60),s=Lt.hero.e.x+10*Math.cos(this.angleOffset),h=Lt.hero.e.y+10*Math.sin(this.angleOffset);this.e.x+=(s-this.e.x>0?this.speed:-this.speed)+i.x,this.e.y+=(h-this.e.y>0?this.speed:-this.speed)+i.y,this.e.isCollidingWith(Lt.hero.e)&&this.safe<=0&&(Lt.hero.hp>0&&Lt.hero.hp--,Lt.shakeTime=.2,tt(Lt.hero,this,5),this.safe=2),Lt.attacks.weapons.forEach(t=>{if(this.e.isCollidingWith(t)){this.active=!1,Lt.hero.power<100&&Lt.hero.power++,Lt.shakeTime=.2;for(let t=0;t<30;t++)Lt.hero.particles.push(new o(Y(3,15),Y(3,15),this.e.x+5,this.e.y+5,0,"circle",!0,y))}})},this.steerFromNearbyMobs=function(t,e){let i=0,s=0,h=0;for(let n=0;n<t.length;n++){let a=t[n],o=Math.sqrt(Math.pow(this.e.x-a.e.x,2)+Math.pow(this.e.y-a.e.y,2));a!==this&&o<e&&(i+=this.e.x-a.e.x,s+=this.e.y-a.e.y,h++)}h>0&&(i/=h,s/=h);let n=Math.sqrt(i*i+s*s);return n>0&&(i/=n,s/=n),{x:i,y:s}}}function u(t=0,e=0){this.x=t,this.y=e}var x=37,y=39,p=38,m=40,w=16,g=87,E=65,M=83,v=68,k=77,H=0,I=2,b=32,S=69,A=49,L=50,R=51,C=52,T=82,P=84;function W(t,e,i,h,n,a,o=0){this.type=a,this.width=t,this.height=e,this.mhWidth=t/-2,this.mhHeight=e/-2,this.mhWScld=t/-2,this.mhHScld=e/-2,this.hWidth=t/2,this.hHeight=e/2,this.cenX=i-this.mhWScld,this.cenY=h-this.mhHScld,this.angle=n,this.x=i,this.y=h,this.image=St,this.alpha=1,this.isSolid=!1,this.flip=!1,this.dir=0,this.id=o,this.open=!1,this.chasePhase="search",this.sx=0,this.sy=0,this.move=function(){ne()&&(this.x-=5,this.dir=1),ae()&&(this.x+=5,this.dir=0),oe()&&(this.y-=5),re()&&(this.y+=5),this.x<-2e3&&(this.x=-2e3),this.x>2e3&&(this.x=2e3),this.y<-2e3&&(this.y=-2e3),this.y>2e3&&(this.y=2e3)},this.update=function(i){this.x=Math.floor(this.x),this.Y=Math.floor(this.Y),ctx.save(),ctx.translate(this.x,this.y),Lt.shakeTime>0&&ctx.translate(Lt.shake,Lt.shake),ctx.globalAlpha=this.alpha,img=this.image,s=this.scale,mhw=this.mhWidth,mhh=this.mhHeight,hw=this.hWidth,hh=this.hHeight,t=this.width,e=this.height,ctx.translate(Lt.cam.x,Lt.cam.y),this.flip?(this.type==B.HAIR2?ctx.translate(8.3*t,0):ctx.translate(-7*-t,0),ctx.scale(-Bt,Bt)):ctx.scale(Bt,Bt),ctx.drawImage(img,this.sx,this.sy,t,e,hw,hh,t,e),ctx.restore(),this.cenX=this.x-this.mhWScld,this.cenY=this.y-this.mhHScld},this.isCollidingWith=function(t){return!(this.x+this.width<t.x-t.width||this.x-this.width>t.x+t.width||this.y+this.height<t.y-t.height||this.y-this.height>t.y+t.height)},this.setType=function(){switch(this.alpha=1,this.sy=0,this.sx=0,this.type){case B.HERO:break;case B.ENEMY:case B.GRASS:this.sx=16;break;case B.SHIELD:this.sx=29;break;case B.HAIR1:this.sx=63,this.width=13,this.height=13;break;case B.HAIR2:this.sx=77,this.width=15,this.height=12;break;case B.HAIR3:this.sx=94,this.width=13,this.height=11;break;case B.HAIR4:this.sx=50,this.sy=12,this.width=11,this.height=8;break;case B.HEAD1:this.sx=2,this.sy=1;break;case B.HEAD2:this.sx=48,this.sy=1;break;case B.HEAD3:this.sx=11,this.sy=17;break;case B.HAND:this.sx=30,this.sy=9;break;case B.ARROW:this.sx=36,this.sy=3;break;case B.SMALLROCK:this.sx=24,this.sy=17;break;case B.BIGROCK:this.sx=35,this.sy=16;break;case B.STUMP:this.sx=23,this.sy=25;break;case B.SMALLMUSH:this.sy=32;break;case B.BIGMUSH:this.sy=20;break;case B.LILY:this.sy=40,this.sx=53;break;case B.LILG:this.sy=40,this.sx=63;break;case B.LILP:this.sy=40,this.sx=73;break;case B.CHEST:this.sy=23,this.sx=67;break;case B.ONE:this.sx=63,this.sy=15;break;case B.TWO:this.sx=75,this.sy=15;break;case B.THREE:this.sx=85,this.sy=29;break;case B.C1:this.sy=40;break;case B.C2:this.sy=40,this.sx=8;break;case B.C2:this.sy=40,this.sx=16;break;case B.C3:this.sy=40,this.sx=24;break;case B.C4:this.sy=40,this.sx=232}this.hWidth=this.width/2,this.hHeight=this.height/2},this.setType()}function D(t,e,i,s,h,n){this.e=new W(16,16,0,0,0,B.HERO),this.hair=new W(13,13,0,0,0,B.HAIR1),this.head=new W(11,9,0,0,0,B.HEAD1),this.rHand=new W(4,4,0,0,0,B.HAND),this.lHand=new W(4,4,0,0,0,B.HAND),this.change=!1,this.handMovementPhase=0,this.hp=100,this.power=0,this.particles=[],this.update=function(t){switch(this.e.move(t),this.e.update(t),this.particles.forEach(e=>{e.update(ctx,t)}),this.particles=this.particles.filter(function(t){return 0==t.remove}),ut&&(Lt.hero.e.flip=1==this.e.dir,Lt.hero.hair.flip=1==this.e.dir,Lt.hero.head.flip=1==this.e.dir),this.head.x=this.e.x+18,this.head.y=this.e.y+18,this.head.update(t),this.hair.type){case B.HAIR1:this.hair.x=this.e.x+8,this.hair.y=this.e.y-6;break;case B.HAIR2:this.hair.x=this.e.x-6,this.hair.y=this.e.y-8;break;case B.HAIR3:this.hair.x=this.e.x+10,this.hair.y=this.e.y+2;break;case B.HAIR4:this.hair.x=this.e.x+18,this.hair.y=this.e.y+20}this.change&&(this.hairChange=!1,this.head.setType(),this.hair.setType()),this.hair.update(t),this.handMovementPhase+=t;let e=3*Math.sin(2*this.handMovementPhase*Math.PI*.4),i=this.e.flip?55:65,s=this.e.flip?15:25;this.rHand.x=this.e.x+i,this.rHand.y=this.e.y+65+e,this.lHand.x=this.e.x+s,this.lHand.y=this.e.y+65+e,this.rHand.update(t),this.lHand.update(t)}}const B={AIR:0,GRASS:1,HERO:2,ENEMY:3,SHIELD:4,HAIR1:5,HAIR2:6,HAIR3:7,HAIR4:8,HAND:9,HEAD1:10,HEAD2:11,HEAD3:12,ARROW:13,SMALLROCK:14,BIGROCK:15,STUMP:16,BIGMUSH:17,SMALLMUSH:18,LILY:19,LILG:20,LILP:21,CHEST:22,ONE:23,TWO:24,THREE:25,C1:26,C2:27,C3:28,C4:29,C5:30};function O(t,e,i){angle=2*Math.PI*(e/i),e>=i&&(angle=2*Math.PI),t.beginPath(),t.fillStyle=1==Xt?"#a6f1c8":"#ffb3a6",t.moveTo(400,35),t.arc(400,35,30,0,2*Math.PI),t.closePath(),t.fill(),t.beginPath(),t.fillStyle="white",t.moveTo(400,35),t.arc(400,35,30,-Math.PI/2,angle-Math.PI/2,!1),t.closePath(),t.fill(),t.beginPath(),t.moveTo(400,35),t.lineTo(400+30*Math.cos(angle-Math.PI/2),35+30*Math.sin(angle-Math.PI/2)),t.strokeStyle=1==Xt?"#589572":"#f8847c",t.lineWidth=3,t.stroke()}function F(t,e,i,s,h,n,a){t.save(),t.translate(0,a);t.fillStyle=h,t.fillRect(10,10,200,20);const o=200*(e/i);t.fillStyle=n,t.fillRect(12,12,196,16),t.fillStyle=s,t.fillRect(12,12,o-4,16),t.font="14px Arial",t.fillStyle="black",t.textAlign="center",t.textBaseline="middle";t.fillText(`${e} / ${i}`,110,20),t.restore()}function G(t,e,i,s){this.x=t,this.y=e,this.w=i,this.h=s}function Y(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function N(t){return new G(t.x,t.y,t.w,t.h)}function U(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y}function K(t,e){this.x=t,this.y=e,this.set=function(t,e){this.x=t,this.y=e}}function q(t,e,i,s,h,n,a,o,r){t.save(),t.globalAlpha=r,t.translate(e,i),t.fillStyle=o,t.fillRect(s,h,n,a),t.restore()}function X(t,e,i){return(1-i)*t+i*e}function $(t,e){return cenX=Math.floor(t/2),cenY=Math.floor(e/2),{x:16*(cenX-cenY)/2,y:16*(cenX+cenY)/2}}function z(t){const e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0);return Math.round(e*t)}function J(t,e,i,s,h,n,a){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=e,t.fillStyle=i,t.fillRect(s,h,n,a),t.restore()}function j(t,e,i,s,h,n,a){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=e,t.font=i,t.fillStyle=s,t.fillText(h,n,a),t.restore()}function Q(t,e,i,s,h){t.font=i;let n=s-t.measureText(e).width/2;V(t,1,i,"BLACK",e,n,h,12),j(t,1,i,"WHITE",e,n,h)}function V(t,e,i,s,h,n,a,o){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=e,t.font=i,t.fillStyle=s,t.strokeStyle=s,t.lineWidth=o,t.strokeText(h,n,a),t.restore()}function Z(t,e,i,s){let h=t/32,n=(e+2*i+s)/32*2,a=n-h,o=h+n;return r=Math.floor(a),c=Math.floor(o),_(r,c)}function _(t,e){return Lt.level.tiles[e+Lt.levels[Lt.hero.e.curLevel].cols*t]}function tt(t,e,i){let s=t.e.x>e.x?1:-1,h=t.e.y>e.y?1:-1;t.e.x+=s*i,t.e.y+=h*i}const et={0:[[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1]],1:[[0,0,1,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],2:[[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1]],3:[[1,1,1,1,1],[0,0,0,0,1],[0,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]],4:[[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[0,0,0,0,1],[0,0,0,0,1]],5:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]],6:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1]],7:[[1,1,1,1,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[0,1,0,0,0]],8:[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1]],9:[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]]};function it(t,e,i,s){for(let h=0;h<et[i].length;h++)for(let n=0;n<et[i][h].length;n++)1===et[i][h][n]&&(ctx.fillStyle="white",ctx.fillRect(t+n*s,e+h*s,s,s))}function st(t){Vt.context.fillStyle="yellow",Vt.context.font="16px Arial",Vt.context.fillText("FPS: "+t.toFixed(2),Yt-100,20)}function ht(t){Vt.context.fillStyle="white",Vt.context.font="16px Arial",Vt.context.fillText("Mobs: "+t,Yt-100,50),Vt.context.fillText("P: "+Lt.attacks.chaseWeapons[0].chasePhase,Yt-100,90)}function nt(t,e,i,s,h,n){ctx.save(),ctx.scale(3,3),ctx.shadowColor=1==n?"#3CB371":"#f67c84",ctx.shadowBlur=10,ctx.shadowOffsetX=5,ctx.shadowOffsetY=5,ctx.fillStyle="white",ctx.fill(),ctx.strokeStyle=1==n?"#3CB371":"#ffb3a6",ctx.lineWidth=4,ctx.stroke(),ctx.beginPath(),ctx.roundRect(50,45,150,90,40),ctx.stroke(),ctx.fill(),ctx.restore()}function at(t){var e=Y(0,360)*Math.PI/180,i=Y(50,180),s=[-1,1][Y(0,1)]*i;return{x:t.x+s*Math.cos(e),y:t.y+s*Math.sin(e)}}function ot(){let t="#";for(var e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}function rt(t){this.hero=t,this.weapons=[],this.spinWeapons=[],this.chaseWeapons=[],this.chasingEntity=new W(7,8,0,0,0,B.C1),this.chaseWeapons.push(this.chasingEntity),this.weapons.push(this.chasingEntity),this.chasingEntity=new W(7,8,0,0,0,B.C2),this.chaseWeapons.push(this.chasingEntity),this.weapons.push(this.chasingEntity),this.chasingTargets=new Set,this.numberOfRotatingItems=5,this.distanceFromHero=80;for(let t=0;t<this.numberOfRotatingItems;t++){const e=2*Math.PI/this.numberOfRotatingItems*t;let i=new W(6,8,this.hero.e.x+32+this.distanceFromHero*Math.cos(e),this.hero.e.y+32+this.distanceFromHero*Math.sin(e),0,B.SHIELD);this.weapons.push(i),this.spinWeapons.push(i)}this.rotate=!0,this.spin=!1,this.chase=!0,this.loop=!1,this.applySeparation=function(t,e){let i=0,s=0;this.chaseWeapons.forEach(e=>{if(e!==t){let h=t.x-e.x,n=t.y-e.y,a=Math.sqrt(h*h+n*n);if(a>0&&a<30){let t=(30-a)/a;i+=h*t,s+=n*t}}}),t.x+=i*e,t.y+=s*e},this.update=function(t,e){if(this.rotate){let i=.8;this.spinWeapons.forEach((s,h)=>{let n=2*e*Math.PI/i+2*Math.PI/this.numberOfRotatingItems*h;s.x=this.hero.e.x+32+this.distanceFromHero*Math.cos(n),s.y=this.hero.e.y+32+this.distanceFromHero*Math.sin(n),s.update(t)})}this.chaseWeapons.forEach(e=>{this.applySeparation(e,t)}),this.chaseWeapons.forEach(e=>{if(this.chase){switch(e.chasePhase){case"search":this.targetEnemy=null;let t=1/0;Lt.spawner.enemies.forEach(i=>{if(!this.chasingTargets.has(i)&&i.active){let s=e.x-i.e.x,h=e.y-i.e.y,n=Math.sqrt(s*s+h*h);n<t&&n<200&&(t=n,this.targetEnemy=i)}}),this.targetEnemy&&(this.chasingTargets.add(this.targetEnemy),e.chasePhase="attack");break;case"attack":if(this.targetEnemy&&this.targetEnemy.active){let t=this.targetEnemy.e.x-e.x,i=this.targetEnemy.e.y-e.y,s=Math.atan2(i,t);e.x+=5*Math.cos(s),e.y+=5*Math.sin(s),Math.sqrt(t*t+i*i)<5&&(e.chasePhase="return")}else e.chasePhase="return";break;case"return":this.targetEnemy&&this.chasingTargets.delete(this.targetEnemy);let i=this.hero.e.x-e.x,s=this.hero.e.y-e.y;if(Math.sqrt(i*i+s*s)>5){let t=Math.atan2(s,i);e.x+=5*Math.cos(t),e.y+=5*Math.sin(t)}else e.chasePhase="search"}e.update(t)}})}}function ct(){this.arrow=new W(11,12,100,60,0,B.ARROW);let t=0,e=0;this.update=function(i){let s=z(.05);Vt.clear(),ctx.save(),J(ctx,.8,"black",0,0,ft,dt);var h=["#a8f2cb","#88e4b0"];h=1==Xt?["#a8f2cb","#88e4b0"]:["#ffb3a6","#ff9e9a"];const n=Math.ceil(Math.sqrt(ctx.canvas.width**2+ctx.canvas.height**2)/50);for(let t=-n;t<n+10;t++)ctx.fillStyle=h[t%2],ctx.beginPath(),ctx.moveTo(50*t+e,0),ctx.lineTo(50*(t+1)+e,0),ctx.lineTo(50*(t+1)+e-ctx.canvas.height,ctx.canvas.height),ctx.lineTo(50*t+e-ctx.canvas.height,ctx.canvas.height),ctx.closePath(),ctx.fill();(e-=.5)<=-100&&(e=0);let a=`${s}px Arial`;if(V(ctx,1,a,"Black","GameDevJS 2024",30,.1*dt,12),j(ctx,1,a,"WHITE","GameDevJS 2024 ",30,.1*dt),a=`${s-15}px Arial`,t<=0&&(oe()?(t=.3,xt--):re()&&(t=.3,xt++),ye()&&(Xt=(Xt+1)%2,t=.3)),xt=(xt+3)%3,nt(0,0,300,300,15,Xt),0==xt){if(this.arrow.y=100,V(ctx,1,a,"BLACK","Select Hair (Left / Right)",30,.2*dt,6),j(ctx,1,a,"WHITE","Select Hair (Left / Right)",30,.2*dt),(ne()||ae())&&t<=0){t=.3;const e=[B.HAIR1,B.HAIR2,B.HAIR3,B.HAIR4];Lt.hero.hair.type=e[(e.indexOf(Lt.hero.hair.type)+1)%e.length],Lt.hero.change=!0}}else if(1==xt){if(this.arrow.y=140,V(ctx,1,a,"BLACK","Select Head (Left / Right)",30,.2*dt,6),j(ctx,1,a,"WHITE","Select Head (Left / Right)",30,.2*dt),(ne()||ae())&&t<=0){t=.3;const e=[B.HEAD1,B.HEAD2,B.HEAD3];Lt.hero.head.type=e[(e.indexOf(Lt.hero.head.type)+1)%e.length],Lt.hero.change=!0,Lt.hero.head.type==B.HEAD3||Lt.hero.head.type==B.HEAD2?(Lt.hero.rHand.sx=16,Lt.hero.rHand.sy=28,Lt.hero.lHand.sx=16,Lt.hero.lHand.sy=28):(Lt.hero.rHand.sx=30,Lt.hero.rHand.sy=9,Lt.hero.lHand.sx=30,Lt.hero.lHand.sy=9)}}else 2==xt&&(this.arrow.y=170,V(ctx,1,a,"BLACK","Select Clothes (Left / Right)",30,.2*dt,6),j(ctx,1,a,"WHITE","Select Clothes (Left / Right)",30,.2*dt));t-=i,Lt.hero.e.x=65,Lt.hero.e.y=30,ctx.save(),ctx.scale(3,3),Lt.hero.update(i),ctx.restore(),ctx.save(),ctx.scale(1.5,1.5),this.arrow.update(i),ctx.restore();let o=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);Q(ctx,"Space to Start",a,ft/2,o-30),ce()&&(ut=!0)}}function lt(){this.cam=new u,this.tips=!0,this.time=0,this.reset=!1,this.hero=new D(16,16,0,0,0,B.HERO),this.attacks=new rt(this.hero),this.spawner=new f(this.hero.e),this.decor=new l,this.intro=new ct;let t=3,e=20,i=0;this.shake=0,this.shakeTime=0,this.shop=!1,this.chests=[],this.chests.push(new W(16,13,-70,30,0,B.CHEST,1)),this.chests.push(new W(16,13,65,30,0,B.CHEST,2)),this.chests.push(new W(16,13,200,30,0,B.CHEST,3));let s=new W(6,5,-30,10,0,B.ONE),h=new W(7,5,100,10,0,B.TWO),n=new W(7,5,230,10,0,B.THREE);this.update=function(a,r=!1){var c=ctx.createLinearGradient(0,0,0,ctx.canvas.height);c.addColorStop(0,"#3CB371"),c.addColorStop(1,"#A6F1C8"),r?(this.shake=Qt?Y(-2,2):0,this.shakeTime>0&&(this.shakeTime-=a),this.cam.x=X(350-this.hero.e.x,this.cam.x,.1),this.cam.y=X(200-this.hero.e.y,this.cam.y,.1),wt+=a,Vt.clear(),ctx.fillStyle=c,ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height),this.time+=a,this.shop&&(wt=0,this.chests.forEach(t=>{if(t.update(a),t.isCollidingWith(this.hero.e)&&!t.open)if(t.open=!0,1==t.id&&this.hero.power>=10){this.hero.power-=10,t.sx=50;for(let e=0;e<30;e++)Lt.hero.particles.push(new o(Y(3,15),Y(3,15),t.x+50,t.y+60,0,"circle",!0,y))}else if(2==t.id&&this.hero.power>=20){this.hero.power-=20,t.sx=50;for(let e=0;e<30;e++)Lt.hero.particles.push(new o(Y(3,15),Y(3,15),t.x+50,t.y+60,0,"circle",!0,y))}else if(3==t.id&&this.hero.power>=30){this.hero.power-=30,t.sx=50;for(let e=0;e<30;e++)Lt.hero.particles.push(new o(Y(3,15),Y(3,15),t.x+50,t.y+60,0,"circle",!0,y))}}),s.update(a),h.update(a),n.update(a),ce()&&(this.spawner.addEnemy(30,300),0,t=3,this.shop=!1,this.chests.forEach(t=>{t.open=!1,t.sx=67}))),this.decor.update(a),this.hero.update(a),t<=0&&wt<=30&&!this.shop?(this.spawner.update(a,this.time),this.attacks.update(a,this.time),O(ctx,wt,30)):wt>=30?(this.shop=!0,wt=0,this.spawner.enemies=[],this.hero.e.x=65,this.hero.e.y=140):t>0&&(t-=a,Math.ceil(t)!=i&&(e=20),it(330,80,Math.ceil(t),e),e+=.3,i=Math.ceil(t)),F(ctx,this.hero.hp,100,"#f68687","#a15156","#faf1f0",0),F(ctx,this.hero.power,100,"#84e3b3","#589572","#f0faf7",30),ht(this.spawner.enemies.length),st(Ot)):this.intro.update(a)}}let ft=window.innerWidth,dt=window.innerHeight,ut=!1,xt=0,yt=0,pt=Date.now(),mt=Date.now(),wt=0,gt=new K(0,0),Et=new K(0,0),Mt=new G(0,0,0,0),vt=!1,kt=!1,Ht=!1,It=!1,bt=0,St=new Image;St.src="atlas.png";let At=new Image,Lt=new lt,Rt=!1,Ct=!1,Tt=!1,Pt=!1,Wt=!1,Dt=.1,Bt=4,Ot=60,Ft=0,Gt=0;var Yt=800,Nt=600,Ut=window.innerWidth,Kt=window.innerHeight,qt=Math.max(Ut/Yt,Kt/Nt),Xt=1,$t=!1,zt=!1,Jt=!1,jt=!1;let Qt=!0;function startGame(){Vt.start(),me(this.ctx),Zt(),document.getElementById("gameControls").addEventListener("touchstart",t=>{t.preventDefault()},{passive:!1})}a();let Vt={canvas:document.createElement("canvas"),start:function(){this.canvas.width=Yt*qt,this.canvas.height=Nt*qt,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),this.context.setTransform(qt,0,0,qt,0,0),ctx=this.context,ctx.mozImageSmoothingEnabled=!1,ctx.webkitImageSmoothingEnabled=!1,ctx.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameId=requestAnimationFrame(se),window.addEventListener("keydown",function(e){Ct||(Ct=!0,t.loop=!0,t.play()),Dt<=0&&3==xt&&(Rt=!0),e.preventDefault(),Vt.keys=Vt.keys||[],Vt.keys[e.keyCode]="keydown"==e.type}),window.addEventListener("keyup",function(t){Vt.keys[t.keyCode]="keydown"==t.type,t.keyCode==T&&(Ht=!0),t.keyCode==k&&(Tt=!Tt),t.keyCode==P&&(Lt.tips=!Lt.tips)}),window.addEventListener("mouseup",function(t){t.preventDefault(),pe(),vt=!0,0===t.button?Pt=!1:2===t.button&&(Wt=!1)}),window.addEventListener("mousedown",function(t){t.preventDefault(),0===t.button?Pt=!0:2===t.button&&(Wt=!0)}),window.addEventListener("resize",me),window.addEventListener("mousemove",function(t){t.preventDefault();var e=Vt.canvas.getBoundingClientRect();gt.set((t.clientX-e.left)/(e.right-e.left)*ft,(t.clientY-e.top)/(e.bottom-e.top)*dt)}),this.canvas.oncontextmenu=function(t){t.preventDefault()}},stop:function(){Vt.frameId&&(cancelAnimationFrame(Vt.frameId),Vt.frameId=null)},clear:function(){this.context.clearRect(0,0,4*this.canvas.width,4*this.canvas.height)}};function Zt(){document.getElementById("up").addEventListener("touchstart",()=>_t("up")),document.getElementById("up").addEventListener("touchend",()=>te("up")),document.getElementById("down").addEventListener("touchstart",()=>_t("down")),document.getElementById("down").addEventListener("touchend",()=>te("down")),document.getElementById("left").addEventListener("touchstart",()=>_t("left")),document.getElementById("left").addEventListener("touchend",()=>te("left")),document.getElementById("right").addEventListener("touchstart",()=>_t("right")),document.getElementById("right").addEventListener("touchend",()=>te("right")),document.getElementById("aButton").addEventListener("touchstart",()=>ee("A")),document.getElementById("bButton").addEventListener("touchstart",()=>ee("B"))}function _t(t){console.log("Move:",t),"up"==t?$t=!0:"down"==t?zt=!0:"left"==t?jt=!0:"right"==t&&(Jt=!0),console.log(t+" - "+$t)}function te(t){"up"==t?$t=!1:"down"==t?zt=!1:"left"==t?jt=!1:"right"==t&&(Jt=!1),console.log(t+" - "+$t)}function ee(t){ut||(ut=!0)}let ie=null;function se(t){ie||(ie=t);let e=(t-ie)/1e3;ie=t,Ft++,(Gt+=e)>=1&&(Ot=Ft/Gt,Ft=0,Gt=0),he(e),st(Ot),Vt.frameId=requestAnimationFrame(se)}function he(t){kt&&(wt=0,kt=!1,It=!1,bt=0,Rt=!1,ut=!1,Dt=3),Rt&&(ut=!0),Dt>0&&(Dt-=t),Lt.update(t,ut),vt=!1}function ne(){return Vt.keys&&(Vt.keys[x]||Vt.keys[E])||jt}function ae(){return Vt.keys&&(Vt.keys[y]||Vt.keys[v])||Jt}function oe(){return Vt.keys&&(Vt.keys[p]||Vt.keys[g])||$t}function re(){return Vt.keys&&(Vt.keys[m]||Vt.keys[M])||zt}function ce(){return Vt.keys&&Vt.keys[b]||Pt}function le(){return Vt.keys&&Vt.keys[w]||Wt}function fe(){return Vt.keys&&Vt.keys[A]}function de(){return Vt.keys&&Vt.keys[L]}function ue(){return Vt.keys&&Vt.keys[R]}function xe(){return Vt.keys&&Vt.keys[C]}function ye(){return Vt.keys&&Vt.keys[P]}function pe(){Et.set(gt.x,gt.y),Mt.x=gt.x-5,Mt.y=gt.y+5,Mt.h=10,Mt.w=10,console.log(Et)}function me(){Ut=window.innerWidth,Kt=window.innerHeight,ft=window.innerWidth,dt=window.innerHeight,qt=Math.max(Ut/Yt,Kt/Nt),scaleFitNative=Math.min(Ut/Yt,Kt/Nt),ctx.canvas.width=Yt*qt,ctx.canvas.height=Nt*qt,this.context=ctx.canvas.getContext("2d"),this.context.setTransform(qt,0,0,qt,0,0),this.ctx.mozImageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1}