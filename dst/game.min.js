function t(){this.decors=[];var t=60;for(let e=0;e<t;e++){let t=4e3*Math.random()-2e3,e=4e3*Math.random()-2e3;this.decors.push(new L(9,6,t,e,0,b.SMALLROCK))}numRocks=50;for(let e=0;e<t;e++){let t=4e3*Math.random()-2e3,e=4e3*Math.random()-2e3;this.decors.push(new L(14,10,t,e,0,b.BIGROCK))}t=30;for(let e=0;e<t;e++){let t=4e3*Math.random()-2e3,e=4e3*Math.random()-2e3;this.decors.push(new L(14,14,t,e,0,b.STUMP))}t=20;for(let e=0;e<t;e++){let t=4e3*Math.random()-2e3,e=4e3*Math.random()-2e3;this.decors.push(new L(10,9,t,e,0,b.BIGMUSH))}t=40;for(let e=0;e<t;e++){let t=4e3*Math.random()-2e3,e=4e3*Math.random()-2e3;this.decors.push(new L(7,7,t,e,0,b.SMALLMUSH))}this.update=function(t,e){this.decors.forEach(e=>{e.update(t)})}}function e(t){this.hero=t;this.enemies=[];for(let t=0;t<30;t++){let e=t/30*2*Math.PI,h=new i(0,0,9,8,[b.LILY,b.LILG,b.LILP][B(0,2)],t,30);h.e.x=this.hero.x+600*Math.cos(e),h.e.y=this.hero.y+600*Math.sin(e),this.enemies.push(h)}this.update=function(t,e){this.enemies.forEach(e=>{e.update(t,this.enemies),e.e.update(t)}),this.enemies=this.enemies.filter(function(t){return t.active})}}function i(t,e,i,h,s,n,a){this.active=!0,this.e=new L(i,h,0,0,0,s),this.speed=.8,this.angleOffset=2*Math.PI*(n/a),this.update=function(t,e){let i=this.steerFromNearbyMobs(e,60),h=Ht.hero.e.x+50*Math.cos(this.angleOffset),s=Ht.hero.e.y+50*Math.sin(this.angleOffset);this.e.x+=(h-this.e.x>0?this.speed:-this.speed)+i.x,this.e.y+=(s-this.e.y>0?this.speed:-this.speed)+i.y,this.e.isCollidingWith(Ht.hero.e)&&Ht.hero.hp--,Ht.attacks.weapons.forEach(t=>{this.e.isCollidingWith(t)&&(this.active=!1,Ht.hero.power++)}),this.e.isCollidingWith(Ht.hero.e)&&(this.active=!1)},this.steerFromNearbyMobs=function(t,e){let i=0,h=0,s=0;for(let n=0;n<t.length;n++){let a=t[n],o=Math.sqrt(Math.pow(this.e.x-a.e.x,2)+Math.pow(this.e.y-a.e.y,2));a!==this&&o<e&&(i+=this.e.x-a.e.x,h+=this.e.y-a.e.y,s++)}s>0&&(i/=s,h/=s);let n=Math.sqrt(i*i+h*h);return n>0&&(i/=n,h/=n),{x:i,y:h}}}function h(t=0,e=0){this.x=t,this.y=e}var n=37,a=39,o=38,l=40,d=16,f=87,x=65,u=83,y=68,g=77,m=0,w=2,p=32,E=69,H=49,v=50,I=51,M=52,k=82,S=84;function L(t,e,i,h,n,a){this.type=a,this.width=t,this.height=e,this.mhWidth=t/-2,this.mhHeight=e/-2,this.mhWScld=t/-2,this.mhHScld=e/-2,this.hWidth=t/2,this.hHeight=e/2,this.cenX=i-this.mhWScld,this.cenY=h-this.mhHScld,this.angle=n,this.x=i,this.y=h,this.image=pt,this.shadow=Et,this.alpha=1,this.isSolid=!1,this.flip=!1,this.dir=0,this.sx=0,this.sy=0,this.move=function(){Qt()&&(this.x-=5,this.dir=1),Vt()&&(this.x+=5,this.dir=0),Zt()&&(this.y-=5),_t()&&(this.y+=5),this.x<-2e3&&(this.x=-2e3),this.x>2e3&&(this.x=2e3),this.y<-2e3&&(this.y=-2e3),this.y>2e3&&(this.y=2e3)},this.update=function(i){this.x=Math.floor(this.x),this.Y=Math.floor(this.Y),ctx.save(),ctx.translate(this.x,this.y),ctx.globalAlpha=this.alpha,img=this.image,s=this.scale,mhw=this.mhWidth,mhh=this.mhHeight,hw=this.hWidth,hh=this.hHeight,t=this.width,e=this.height,ctx.translate(Ht.cam.x,Ht.cam.y),this.flip?(this.type==b.HAIR2?ctx.translate(8.3*t,0):ctx.translate(-7*-t,0),ctx.scale(-At,At)):ctx.scale(At,At),ctx.drawImage(img,this.sx,this.sy,t,e,hw,hh,t,e),ctx.restore(),this.cenX=this.x-this.mhWScld,this.cenY=this.y-this.mhHScld},this.isCollidingWith=function(t){return!(this.x+this.width<t.x-t.width||this.x-this.width>t.x+t.width||this.y+this.height<t.y-t.height||this.y-this.height>t.y+t.height)},this.setType=function(){switch(this.alpha=1,this.sy=0,this.sx=0,this.type){case b.HERO:break;case b.ENEMY:case b.GRASS:this.sx=16;break;case b.SHIELD:this.sx=29;break;case b.HAIR1:this.sx=63,this.width=13,this.height=13;break;case b.HAIR2:this.sx=77,this.width=15,this.height=12;break;case b.HAIR3:this.sx=94,this.width=13,this.height=11;break;case b.HAIR4:this.sx=50,this.sy=12,this.width=11,this.height=8;break;case b.HEAD1:this.sx=2,this.sy=1;break;case b.HEAD2:this.sx=48,this.sy=1;break;case b.HEAD3:this.sx=11,this.sy=17;break;case b.HAND:this.sx=30,this.sy=9;break;case b.ARROW:this.sx=36,this.sy=3;break;case b.SMALLROCK:this.sx=24,this.sy=17;break;case b.BIGROCK:this.sx=35,this.sy=16;break;case b.STUMP:this.sx=23,this.sy=25;break;case b.SMALLMUSH:this.sy=32;break;case b.BIGMUSH:this.sy=20;break;case b.LILY:this.sy=40,this.sx=53;break;case b.LILG:this.sy=40,this.sx=63;break;case b.LILP:this.sy=40,this.sx=73}this.hWidth=this.width/2,this.hHeight=this.height/2},this.setType()}function A(t,e,i,h,s,n){this.e=new L(16,16,0,0,0,b.HERO),this.hair=new L(13,13,0,0,0,b.HAIR1),this.head=new L(11,9,0,0,0,b.HEAD1),this.rHand=new L(4,4,0,0,0,b.HAND),this.lHand=new L(4,4,0,0,0,b.HAND),this.change=!1,this.handMovementPhase=0,this.hp=100,this.power=0,this.update=function(t){switch(this.e.move(t),this.e.update(t),nt&&(Ht.hero.e.flip=1==this.e.dir,Ht.hero.hair.flip=1==this.e.dir,Ht.hero.head.flip=1==this.e.dir),this.head.x=this.e.x+18,this.head.y=this.e.y+18,this.head.update(t),this.hair.type){case b.HAIR1:this.hair.x=this.e.x+8,this.hair.y=this.e.y-6;break;case b.HAIR2:this.hair.x=this.e.x-6,this.hair.y=this.e.y-8;break;case b.HAIR3:this.hair.x=this.e.x+10,this.hair.y=this.e.y+2;break;case b.HAIR4:this.hair.x=this.e.x+18,this.hair.y=this.e.y+20}this.change&&(this.hairChange=!1,this.head.setType(),this.hair.setType()),this.hair.update(t),this.handMovementPhase+=t;let e=3*Math.sin(2*this.handMovementPhase*Math.PI*.4),i=this.e.flip?55:65,h=this.e.flip?15:25;this.rHand.x=this.e.x+i,this.rHand.y=this.e.y+65+e,this.lHand.x=this.e.x+h,this.lHand.y=this.e.y+65+e,this.rHand.update(t),this.lHand.update(t)}}const b={AIR:0,GRASS:1,HERO:2,ENEMY:3,SHIELD:4,HAIR1:5,HAIR2:6,HAIR3:7,HAIR4:8,HAND:9,HEAD1:10,HEAD2:11,HEAD3:12,ARROW:13,SMALLROCK:14,BIGROCK:15,STUMP:16,BIGMUSH:17,SMALLMUSH:18,LILY:19,LILG:20,LILP:21};function R(t,e,i){angle=2*Math.PI*(e/i),e>=i&&(angle=2*Math.PI),t.beginPath(),t.fillStyle=1==Ot?"#a6f1c8":"#ffb3a6",t.moveTo(400,35),t.arc(400,35,30,0,2*Math.PI),t.closePath(),t.fill(),t.beginPath(),t.fillStyle="white",t.moveTo(400,35),t.arc(400,35,30,-Math.PI/2,angle-Math.PI/2,!1),t.closePath(),t.fill(),t.beginPath(),t.moveTo(400,35),t.lineTo(400+30*Math.cos(angle-Math.PI/2),35+30*Math.sin(angle-Math.PI/2)),t.strokeStyle=1==Ot?"#589572":"#f8847c",t.lineWidth=3,t.stroke()}function D(t,e,i,h,s,n,a){t.save(),t.translate(0,a);t.fillStyle=s,t.fillRect(10,10,200,20);const o=200*(e/i);t.fillStyle=n,t.fillRect(12,12,196,16),t.fillStyle=h,t.fillRect(12,12,o-4,16),t.font="14px Arial",t.fillStyle="black",t.textAlign="center",t.textBaseline="middle";t.fillText(`${e} / ${i}`,110,20),t.restore()}function C(t,e,i,h){this.x=t,this.y=e,this.w=i,this.h=h}function B(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function T(t){return new C(t.x,t.y,t.w,t.h)}function P(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y}function W(t,e){this.x=t,this.y=e,this.set=function(t,e){this.x=t,this.y=e}}function O(t,e,i,h,s,n,a,o,c){t.save(),t.globalAlpha=c,t.translate(e,i),t.fillStyle=o,t.fillRect(h,s,n,a),t.restore()}function G(t,e,i){return(1-i)*t+i*e}function Y(t,e){return cenX=Math.floor(t/2),cenY=Math.floor(e/2),{x:16*(cenX-cenY)/2,y:16*(cenX+cenY)/2}}function K(t){const e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0);return Math.round(e*t)}function N(t,e,i,h,s,n,a){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=e,t.fillStyle=i,t.fillRect(h,s,n,a),t.restore()}function U(t,e,i,h,s,n,a){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=e,t.font=i,t.fillStyle=h,t.fillText(s,n,a),t.restore()}function F(t,e,i,h,s){t.font=i;let n=h-t.measureText(e).width/2;X(t,1,i,"BLACK",e,n,s,12),U(t,1,i,"WHITE",e,n,s)}function X(t,e,i,h,s,n,a,o){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=e,t.font=i,t.fillStyle=h,t.strokeStyle=h,t.lineWidth=o,t.strokeText(s,n,a),t.restore()}function q(t,e,i,h){let s=t/32,n=(e+2*i+h)/32*2,a=n-s,o=s+n;return r=Math.floor(a),c=Math.floor(o),$(r,c)}function $(t,e){return Ht.level.tiles[e+Ht.levels[Ht.hero.e.curLevel].cols*t]}function z(t,e,i){let h=t.e.x>e.x?1:-1,s=t.e.y>e.y?1:-1;t.e.x+=h*i,t.e.y+=s*i}const J={0:[[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1]],1:[[0,0,1,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],2:[[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1]],3:[[1,1,1,1,1],[0,0,0,0,1],[0,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]],4:[[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[0,0,0,0,1],[0,0,0,0,1]],5:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]],6:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1]],7:[[1,1,1,1,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[0,1,0,0,0]],8:[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1]],9:[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1]]};function j(t,e,i,h){for(let s=0;s<J[i].length;s++)for(let n=0;n<J[i][s].length;n++)1===J[i][s][n]&&(ctx.fillStyle="white",ctx.fillRect(t+n*h,e+s*h,h,h))}function Q(t){Ut.context.fillStyle="yellow",Ut.context.font="16px Arial",Ut.context.fillText("FPS: "+t.toFixed(2),Ct-100,20)}function V(t){Ut.context.fillStyle="white",Ut.context.font="16px Arial",Ut.context.fillText("Mobs: "+t,Ct-100,50)}function Z(t,e,i,h,s,n){ctx.save(),ctx.scale(3,3),ctx.shadowColor=1==n?"#3CB371":"#f67c84",ctx.shadowBlur=10,ctx.shadowOffsetX=5,ctx.shadowOffsetY=5,ctx.fillStyle="white",ctx.fill(),ctx.strokeStyle=1==n?"#3CB371":"#ffb3a6",ctx.lineWidth=4,ctx.stroke(),ctx.beginPath(),ctx.roundRect(50,45,150,90,40),ctx.stroke(),ctx.fill(),ctx.restore()}function _(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0);const h=i.getImageData(0,0,e.width,e.height),s=h.data;for(let t=0;t<s.length;t+=4)0!==s[t+3]&&(s[t]=0,s[t+1]=0,s[t+2]=0);i.putImageData(h,0,0);const n=new Image;return n.src=e.toDataURL("image/png"),n}function tt(t){this.hero=t,this.weapons=[],this.rotatingEntity=new L(6,8,0,0,0,b.SHIELD),this.spinningEntity=new L(4,4,0,0,0,b.SHIELD),this.chasingEntity=new L(6,8,0,0,0,b.SHIELD),this.helicalEntity=new L(6,8,0,0,0,b.SHIELD),this.figureEightEntity=new L(4,4,0,0,0,b.SHIELD),this.weapons.push(this.rotatingEntity),this.rotate=!0,this.spin=!1,this.chase=!1,this.loop=!1,this.update=function(t,e){if(this.rotate){let i=60,h=.8,s=2*e*Math.PI/h;this.rotatingEntity.x=this.hero.e.x+32+i*Math.cos(s),this.rotatingEntity.y=this.hero.e.y+32+i*Math.sin(s),this.rotatingEntity.update(t)}if(this.spin){let i=60,h=2*e*Math.PI/.6;this.spinningEntity.x=this.rotatingEntity.x+16+i*Math.cos(h),this.spinningEntity.y=this.rotatingEntity.y+16+i*Math.sin(h),this.spinningEntity.update(t)}if(this.chase){let e=.1,i=this.hero.e.x-this.chasingEntity.x,h=this.hero.e.y-this.chasingEntity.y;Math.sqrt(i*i+h*h)>1&&(this.chasingEntity.x+=e*i,this.chasingEntity.y+=e*h),this.chasingEntity.update(t)}if(this.loop){radius=80;let i=2,h=this.hero.e.x+32+radius*Math.sin(e*i),s=this.hero.e.y+50+radius*Math.sin(2*e*i);this.figureEightEntity.x=h,this.figureEightEntity.y=s,this.figureEightEntity.update(t)}}}function et(){this.arrow=new L(11,12,100,60,0,b.ARROW);let t=0,e=0;this.update=function(i){let h=K(.05);Ut.clear(),ctx.save(),N(ctx,.8,"black",0,0,ht,st);var s=["#a8f2cb","#88e4b0"];s=1==Ot?["#a8f2cb","#88e4b0"]:["#ffb3a6","#ff9e9a"];const n=Math.ceil(Math.sqrt(ctx.canvas.width**2+ctx.canvas.height**2)/50);for(let t=-n;t<n+10;t++)ctx.fillStyle=s[t%2],ctx.beginPath(),ctx.moveTo(50*t+e,0),ctx.lineTo(50*(t+1)+e,0),ctx.lineTo(50*(t+1)+e-ctx.canvas.height,ctx.canvas.height),ctx.lineTo(50*t+e-ctx.canvas.height,ctx.canvas.height),ctx.closePath(),ctx.fill();(e-=.5)<=-100&&(e=0);let a=`${h}px Arial`;if(X(ctx,1,a,"Black","GameDevJS 2024",30,.1*st,12),U(ctx,1,a,"WHITE","GameDevJS 2024 ",30,.1*st),a=`${h-15}px Arial`,t<=0&&(Zt()?(t=.3,at--):_t()&&(t=.3,at++),ae()&&(Ot=(Ot+1)%2,t=.3)),at=(at+3)%3,Z(0,0,300,300,15,Ot),0==at){if(this.arrow.y=100,X(ctx,1,a,"BLACK","Select Hair (Left / Right)",30,.2*st,6),U(ctx,1,a,"WHITE","Select Hair (Left / Right)",30,.2*st),(Qt()||Vt())&&t<=0){t=.3;const e=[b.HAIR1,b.HAIR2,b.HAIR3,b.HAIR4];Ht.hero.hair.type=e[(e.indexOf(Ht.hero.hair.type)+1)%e.length],Ht.hero.change=!0}}else if(1==at){if(this.arrow.y=140,X(ctx,1,a,"BLACK","Select Head (Left / Right)",30,.2*st,6),U(ctx,1,a,"WHITE","Select Head (Left / Right)",30,.2*st),(Qt()||Vt())&&t<=0){t=.3;const e=[b.HEAD1,b.HEAD2,b.HEAD3];Ht.hero.head.type=e[(e.indexOf(Ht.hero.head.type)+1)%e.length],Ht.hero.change=!0,Ht.hero.head.type==b.HEAD3||Ht.hero.head.type==b.HEAD2?(Ht.hero.rHand.sx=16,Ht.hero.rHand.sy=28,Ht.hero.lHand.sx=16,Ht.hero.lHand.sy=28):(Ht.hero.rHand.sx=30,Ht.hero.rHand.sy=9,Ht.hero.lHand.sx=30,Ht.hero.lHand.sy=9)}}else 2==at&&(this.arrow.y=170,X(ctx,1,a,"BLACK","Select Clothes (Left / Right)",30,.2*st,6),U(ctx,1,a,"WHITE","Select Clothes (Left / Right)",30,.2*st));t-=i,Ht.hero.e.x=65,Ht.hero.e.y=30,ctx.save(),ctx.scale(3,3),Ht.hero.update(i),ctx.restore(),ctx.save(),ctx.scale(1.5,1.5),this.arrow.update(i),ctx.restore();let o=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);F(ctx,"Space to Start",a,ht/2,o-30),te()&&(nt=!0)}}function it(){this.cam=new h,this.tips=!0,this.time=0,this.reset=!1,this.hero=new A(16,16,0,0,0,b.HERO),this.attacks=new tt(this.hero),this.spawner=new e(this.hero.e),this.decor=new t,this.intro=new et;let i=3,s=20,n=0;this.update=function(t,e=!1){var h=ctx.createLinearGradient(0,0,0,ctx.canvas.height);h.addColorStop(0,"#3CB371"),h.addColorStop(1,"#A6F1C8"),e?(this.cam.x=G(350-this.hero.e.x,this.cam.x,.1),this.cam.y=G(200-this.hero.e.y,this.cam.y,.1),lt+=t,Ut.clear(),ctx.fillStyle=h,ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height),this.time+=t,this.decor.update(t),this.hero.update(t),i<=0?(this.spawner.update(t,this.time),this.attacks.update(t,this.time),R(ctx,lt,20),lt>=20&&(lt=0,i=3,this.spawner.enemies=[],0,this.hero.e.x=65,this.hero.e.y=30)):(i-=t,Math.ceil(i)!=n&&(s=20),s+=.3,n=Math.ceil(i),j(330,80,Math.ceil(i),s)),D(ctx,this.hero.hp,100,"#f68687","#a15156","#faf1f0",0),D(ctx,this.hero.power,100,"#84e3b3","#589572","#f0faf7",30),V(this.spawner.enemies.length),Q(bt)):this.intro.update(t)}}let ht=window.innerWidth,st=window.innerHeight,nt=!1,at=0,ot=0,ct=Date.now(),rt=Date.now(),lt=0,dt=new W(0,0),ft=new W(0,0),xt=new C(0,0,0,0),ut=!1,yt=!1,gt=!1,mt=!1,wt=0,pt=new Image;pt.src="atlas.png";let Et=new Image,Ht=new it,vt=!1,It=!0,Mt=!1,kt=!1,St=!1,Lt=.1,At=4,bt=60,Rt=0,Dt=0;var Ct=800,Bt=600,Tt=window.innerWidth,Pt=window.innerHeight,Wt=Math.max(Tt/Ct,Pt/Bt),Ot=1,Gt=!1,Yt=!1,Kt=!1,Nt=!1;function startGame(){Ut.start(),ce(this.ctx),Ft(),document.getElementById("gameControls").addEventListener("touchstart",t=>{t.preventDefault()},{passive:!1})}let Ut={canvas:document.createElement("canvas"),start:function(){this.canvas.width=Ct*Wt,this.canvas.height=Bt*Wt,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),this.context.setTransform(Wt,0,0,Wt,0,0),ctx=this.context,ctx.mozImageSmoothingEnabled=!1,ctx.webkitImageSmoothingEnabled=!1,ctx.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameId=requestAnimationFrame(Jt),Et.src="atlas.png",Et.onload=function(){Et=_(Et)},window.addEventListener("keydown",function(t){Lt<=0&&3==at&&(vt=!0),t.preventDefault(),Ut.keys=Ut.keys||[],Ut.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){Ut.keys[t.keyCode]="keydown"==t.type,t.keyCode==k&&(gt=!0),t.keyCode==g&&(Mt=!Mt),t.keyCode==S&&(Ht.tips=!Ht.tips)}),window.addEventListener("mouseup",function(t){t.preventDefault(),oe(),ut=!0,0===t.button?kt=!1:2===t.button&&(St=!1)}),window.addEventListener("mousedown",function(t){t.preventDefault(),0===t.button?kt=!0:2===t.button&&(St=!0)}),window.addEventListener("resize",ce),window.addEventListener("mousemove",function(t){t.preventDefault();var e=Ut.canvas.getBoundingClientRect();dt.set((t.clientX-e.left)/(e.right-e.left)*ht,(t.clientY-e.top)/(e.bottom-e.top)*st)}),this.canvas.oncontextmenu=function(t){t.preventDefault()}},stop:function(){Ut.frameId&&(cancelAnimationFrame(Ut.frameId),Ut.frameId=null)},clear:function(){this.context.clearRect(0,0,4*this.canvas.width,4*this.canvas.height)}};function Ft(){document.getElementById("up").addEventListener("touchstart",()=>Xt("up")),document.getElementById("up").addEventListener("touchend",()=>qt("up")),document.getElementById("down").addEventListener("touchstart",()=>Xt("down")),document.getElementById("down").addEventListener("touchend",()=>qt("down")),document.getElementById("left").addEventListener("touchstart",()=>Xt("left")),document.getElementById("left").addEventListener("touchend",()=>qt("left")),document.getElementById("right").addEventListener("touchstart",()=>Xt("right")),document.getElementById("right").addEventListener("touchend",()=>qt("right")),document.getElementById("aButton").addEventListener("touchstart",()=>$t("A")),document.getElementById("bButton").addEventListener("touchstart",()=>$t("B"))}function Xt(t){console.log("Move:",t),"up"==t?Gt=!0:"down"==t?Yt=!0:"left"==t?Nt=!0:"right"==t&&(Kt=!0),console.log(t+" - "+Gt)}function qt(t){"up"==t?Gt=!1:"down"==t?Yt=!1:"left"==t?Nt=!1:"right"==t&&(Kt=!1),console.log(t+" - "+Gt)}function $t(t){console.log("Button pressed:",t),nt||(nt=!0)}let zt=null;function Jt(t){zt||(zt=t);let e=(t-zt)/1e3;zt=t,Rt++,(Dt+=e)>=1&&(bt=Rt/Dt,Rt=0,Dt=0),jt(e),Q(bt),Ut.frameId=requestAnimationFrame(Jt)}function jt(t){yt&&(lt=0,yt=!1,mt=!1,wt=0,vt=!1,nt=!1,Lt=3),vt&&(nt=!0),Lt>0&&(Lt-=t),Ht.update(t,nt),ut=!1}function Qt(){return Ut.keys&&(Ut.keys[n]||Ut.keys[x])||Nt}function Vt(){return Ut.keys&&(Ut.keys[a]||Ut.keys[y])||Kt}function Zt(){return Ut.keys&&(Ut.keys[o]||Ut.keys[f])||Gt}function _t(){return Ut.keys&&(Ut.keys[l]||Ut.keys[u])||Yt}function te(){return Ut.keys&&Ut.keys[p]||kt}function ee(){return Ut.keys&&Ut.keys[d]||St}function ie(){return Ut.keys&&Ut.keys[H]}function he(){return Ut.keys&&Ut.keys[v]}function se(){return Ut.keys&&Ut.keys[I]}function ne(){return Ut.keys&&Ut.keys[M]}function ae(){return Ut.keys&&Ut.keys[S]}function oe(){ft.set(dt.x,dt.y),xt.x=dt.x-5,xt.y=dt.y+5,xt.h=10,xt.w=10,console.log(ft)}function ce(){Tt=window.innerWidth,Pt=window.innerHeight,ht=window.innerWidth,st=window.innerHeight,Wt=Math.max(Tt/Ct,Pt/Bt),scaleFitNative=Math.min(Tt/Ct,Pt/Bt),ctx.canvas.width=Ct*Wt,ctx.canvas.height=Bt*Wt,this.context=ctx.canvas.getContext("2d"),this.context.setTransform(Wt,0,0,Wt,0,0),this.ctx.mozImageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1}